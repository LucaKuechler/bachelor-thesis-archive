{
    "rules": [
        {
            "name": "Sysmon Configuration Modification",
            "splunk": "State=\"Stopped\" OR \"Sysmon config state changed\" NOT State=\"Started\"",
            "elastic": "(winlog.event_data.State:Stopped OR \"\"Sysmon\\ config\\ state\\ changed\"\") AND (NOT winlog.event_data.State:Started)",
            "insightidr": "(State = NOCASE(\"Stopped\") OR \"Sysmon config state changed\") AND NOT State = NOCASE(\"Started\")"
        },
        {
            "name": "Disable Windows Defender Functionalities Via Registry Keys",
            "splunk": "TargetObject IN (\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows Defender\\\\*\", \"*\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender Security Center\\\\*\", \"*\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\*\") (TargetObject IN (\"*\\\\DisableAntiSpyware\", \"*\\\\DisableAntiVirus\", \"*\\\\Real-Time Protection\\\\DisableBehaviorMonitoring\", \"*\\\\Real-Time Protection\\\\DisableIntrusionPreventionSystem\", \"*\\\\Real-Time Protection\\\\DisableIOAVProtection\", \"*\\\\Real-Time Protection\\\\DisableOnAccessProtection\", \"*\\\\Real-Time Protection\\\\DisableRealtimeMonitoring\", \"*\\\\Real-Time Protection\\\\DisableScanOnRealtimeEnable\", \"*\\\\Real-Time Protection\\\\DisableScriptScanning\", \"*\\\\Reporting\\\\DisableEnhancedNotifications\", \"*\\\\SpyNet\\\\DisableBlockAtFirstSeen\") Details=\"DWORD (0x00000001)\") OR (TargetObject IN (\"*\\\\App and Browser protection\\\\DisallowExploitProtectionOverride\", \"*\\\\Features\\\\TamperProtection\", \"*\\\\MpEngine\\\\MpEnablePus\", \"*\\\\PUAProtection\", \"*\\\\Signature Update\\\\ForceUpdateFromMU\", \"*\\\\SpyNet\\\\SpynetReporting\", \"*\\\\SpyNet\\\\SubmitSamplesConsent\", \"*\\\\Windows Defender Exploit Guard\\\\Controlled Folder Access\\\\EnableControlledFolderAccess\") Details=\"DWORD (0x00000000)\")",
            "elastic": "(registry.path:(\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\ Defender\\\\*\" OR \"*\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\ Defender\\ Security\\ Center\\\\*\" OR \"*\\\\SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\ Defender\\\\*\")) AND (((registry.path:(*\\\\DisableAntiSpyware OR *\\\\DisableAntiVirus OR \"*\\\\Real\\-Time\\ Protection\\\\DisableBehaviorMonitoring\" OR \"*\\\\Real\\-Time\\ Protection\\\\DisableIntrusionPreventionSystem\" OR \"*\\\\Real\\-Time\\ Protection\\\\DisableIOAVProtection\" OR \"*\\\\Real\\-Time\\ Protection\\\\DisableOnAccessProtection\" OR \"*\\\\Real\\-Time\\ Protection\\\\DisableRealtimeMonitoring\" OR \"*\\\\Real\\-Time\\ Protection\\\\DisableScanOnRealtimeEnable\" OR \"*\\\\Real\\-Time\\ Protection\\\\DisableScriptScanning\" OR *\\\\Reporting\\\\DisableEnhancedNotifications OR *\\\\SpyNet\\\\DisableBlockAtFirstSeen)) AND winlog.event_data.Details:\"DWORD\\ \\(0x00000001\\)\") OR ((registry.path:(\"*\\\\App\\ and\\ Browser\\ protection\\\\DisallowExploitProtectionOverride\" OR *\\\\Features\\\\TamperProtection OR *\\\\MpEngine\\\\MpEnablePus OR *\\\\PUAProtection OR \"*\\\\Signature\\ Update\\\\ForceUpdateFromMU\" OR *\\\\SpyNet\\\\SpynetReporting OR *\\\\SpyNet\\\\SubmitSamplesConsent OR \"*\\\\Windows\\ Defender\\ Exploit\\ Guard\\\\Controlled\\ Folder\\ Access\\\\EnableControlledFolderAccess\")) AND winlog.event_data.Details:\"DWORD\\ \\(0x00000000\\)\"))",
            "insightidr": "(TargetObject ICONTAINS-ANY [\"\\SOFTWARE\\Microsoft\\Windows Defender\\\", \"\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\\", \"\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\\"]) AND ((TargetObject=/(.*\\\\DisableAntiSpyware$|.*\\\\DisableAntiVirus$|.*\\\\Real\\-Time\\ Protection\\\\DisableBehaviorMonitoring$|.*\\\\Real\\-Time\\ Protection\\\\DisableIntrusionPreventionSystem$|.*\\\\Real\\-Time\\ Protection\\\\DisableIOAVProtection$|.*\\\\Real\\-Time\\ Protection\\\\DisableOnAccessProtection$|.*\\\\Real\\-Time\\ Protection\\\\DisableRealtimeMonitoring$|.*\\\\Real\\-Time\\ Protection\\\\DisableScanOnRealtimeEnable$|.*\\\\Real\\-Time\\ Protection\\\\DisableScriptScanning$|.*\\\\Reporting\\\\DisableEnhancedNotifications$|.*\\\\SpyNet\\\\DisableBlockAtFirstSeen$)/i) AND Details = NOCASE(\"DWORD (0x00000001)\") OR (TargetObject=/(.*\\\\App\\ and\\ Browser\\ protection\\\\DisallowExploitProtectionOverride$|.*\\\\Features\\\\TamperProtection$|.*\\\\MpEngine\\\\MpEnablePus$|.*\\\\PUAProtection$|.*\\\\Signature\\ Update\\\\ForceUpdateFromMU$|.*\\\\SpyNet\\\\SpynetReporting$|.*\\\\SpyNet\\\\SubmitSamplesConsent$|.*\\\\Windows\\ Defender\\ Exploit\\ Guard\\\\Controlled\\ Folder\\ Access\\\\EnableControlledFolderAccess$)/i) AND Details = NOCASE(\"DWORD (0x00000000)\"))"
        },
        {
            "name": "Modify User Shell Folders Startup Value",
            "splunk": "TargetObject=\"*SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\User Shell Folders*\" TargetObject=\"*Startup\"",
            "elastic": "registry.path:\"*SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Explorer\\\\User\\ Shell\\ Folders*\" AND registry.path:*Startup",
            "insightidr": "TargetObject ICONTAINS \"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders\" AND TargetObject=/.*Startup$/i"
        },
        {
            "name": "New RUN Key Pointing to Suspicious Folder",
            "splunk": "TargetObject IN (\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\*\", \"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\*\") Details IN (\"*:\\\\$Recycle.bin\\\\*\", \"*:\\\\Temp\\\\*\", \"*:\\\\Users\\\\Default\\\\*\", \"*:\\\\Users\\\\Desktop\\\\*\", \"*:\\\\Users\\\\Public\\\\*\", \"*:\\\\Windows\\\\Temp\\\\*\", \"*\\\\AppData\\\\Local\\\\Temp\\\\*\", \"*%temp%\\\\*\", \"*%tmp%\\\\*\") OR Details IN (\"%Public%\\\\*\", \"wscript*\", \"cscript*\") | table Image",
            "elastic": "(registry.path:(*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\* OR *\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\*)) AND ((winlog.event_data.Details:(*\\:\\\\$Recycle.bin\\\\* OR *\\:\\\\Temp\\\\* OR *\\:\\\\Users\\\\Default\\\\* OR *\\:\\\\Users\\\\Desktop\\\\* OR *\\:\\\\Users\\\\Public\\\\* OR *\\:\\\\Windows\\\\Temp\\\\* OR *\\\\AppData\\\\Local\\\\Temp\\\\* OR *%temp%\\\\* OR *%tmp%\\\\*)) OR (winlog.event_data.Details:(%Public%\\\\* OR wscript* OR cscript*)))",
            "insightidr": "(TargetObject ICONTAINS-ANY [\"\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\\", \"\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\\"]) AND (Details ICONTAINS-ANY [\":\\$Recycle.bin\\\", \":\\Temp\\\", \":\\Users\\Default\\\", \":\\Users\\Desktop\\\", \":\\Users\\Public\\\", \":\\Windows\\Temp\\\", \"\\AppData\\Local\\Temp\\\", \"%temp%\\\", \"%tmp%\\\"] OR Details ISTARTS-WITH-ANY [\"%Public%\\\", \"wscript\", \"cscript\"])"
        },
        {
            "name": "New Application in AppCompat",
            "splunk": "TargetObject=\"*\\\\AppCompatFlags\\\\Compatibility Assistant\\\\Store\\\\*\"",
            "elastic": "registry.path:\"*\\\\AppCompatFlags\\\\Compatibility\\ Assistant\\\\Store\\\\*\"",
            "insightidr": "TargetObject ICONTAINS \"\\AppCompatFlags\\Compatibility Assistant\\Store\\\""
        },
        {
            "name": "Disable UAC Using Registry",
            "splunk": "TargetObject=\"*SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\EnableLUA*\" Details=\"DWORD (0x00000000)\"",
            "elastic": "registry.path:*SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Policies\\\\System\\\\EnableLUA* AND winlog.event_data.Details:\"DWORD\\ \\(0x00000000\\)\"",
            "insightidr": "TargetObject ICONTAINS \"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\EnableLUA\" AND Details = NOCASE(\"DWORD (0x00000000)\")"
        },
        {
            "name": "Windows Defender Exclusions Added - Registry",
            "splunk": "TargetObject=\"*\\\\Microsoft\\\\Windows Defender\\\\Exclusions*\"",
            "elastic": "registry.path:\"*\\\\Microsoft\\\\Windows\\ Defender\\\\Exclusions*\"",
            "insightidr": "TargetObject ICONTAINS \"\\Microsoft\\Windows Defender\\Exclusions\""
        },
        {
            "name": "Wow6432Node Windows NT CurrentVersion Autorun Keys Modification",
            "splunk": "TargetObject=\"*\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows NT\\\\CurrentVersion*\" TargetObject IN (\"*\\\\Windows\\\\Appinit_Dlls*\", \"*\\\\Image File Execution Options*\", \"*\\\\Drivers32*\") NOT (Details IN (\"(Empty)\", \"\\\\REGISTRY\\\\MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Image File Execution Options\")) | table SecurityID,ObjectName,OldValueType,NewValueType",
            "elastic": "registry.path:\"*\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\ NT\\\\CurrentVersion*\" AND (registry.path:(*\\\\Windows\\\\Appinit_Dlls* OR \"*\\\\Image\\ File\\ Execution\\ Options*\" OR *\\\\Drivers32*)) AND (NOT (winlog.event_data.Details:(\\(Empty\\) OR \"\\\\REGISTRY\\\\MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Windows\\ NT\\\\CurrentVersion\\\\Image\\ File\\ Execution\\ Options\")))",
            "insightidr": "TargetObject ICONTAINS \"\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\" AND (TargetObject ICONTAINS-ANY [\"\\Windows\\Appinit_Dlls\", \"\\Image File Execution Options\", \"\\Drivers32\"]) AND NOT (Details IIN [\"(Empty)\", \"\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\"])"
        },
        {
            "name": "Wow6432Node CurrentVersion Autorun Keys Modification",
            "splunk": "TargetObject=\"*\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion*\" TargetObject IN (\"*\\\\ShellServiceObjectDelayLoad*\", \"*\\\\Run\\\\*\", \"*\\\\RunOnce\\\\*\", \"*\\\\RunOnceEx\\\\*\", \"*\\\\RunServices\\\\*\", \"*\\\\RunServicesOnce\\\\*\", \"*\\\\Explorer\\\\ShellServiceObjects*\", \"*\\\\Explorer\\\\ShellIconOverlayIdentifiers*\", \"*\\\\Explorer\\\\ShellExecuteHooks*\", \"*\\\\Explorer\\\\SharedTaskScheduler*\", \"*\\\\Explorer\\\\Browser Helper Objects*\") NOT (Details=\"(Empty)\" OR (Image=\"*C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\{*\" Image=\"*\\\\setup.exe*\") OR (Image=\"C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\OfficeClickToRun.exe\" TargetObject=\"*\\\\Office\\\\ClickToRun\\\\REGISTRY\\\\MACHINE\\\\Software\\\\Wow6432Node\\\\*\") OR (Image IN (\"C:\\\\Program Files\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\", \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\") TargetObject=\"*\\\\Explorer\\\\Browser Helper Objects\\\\{31D09BA0-12F5-4CCE-BE8A-2923E76605DA}\\\\*\") OR Details=\"*-A251-47B7-93E1-CDD82E34AF8B}\" OR Details=\"grpconv -o\" OR (Details=\"*C:\\\\Program Files*\" Details=\"*\\\\Dropbox\\\\Client\\\\Dropbox.exe*\" Details=\"* /systemstartup*\") OR TargetObject=\"*\\\\Explorer\\\\Browser Helper Objects\\\\{92EF2EAD-A7CE-4424-B0DB-499CF856608E}\\\\NoExplorer\" OR (Image=\"*\\\\windowsdesktop-runtime-*\" TargetObject IN (\"*\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\{e2d1ae32-dd1d-4ad7-a298-10e42e7840fc}\", \"*\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\{7037b699-7382-448c-89a7-4765961d2537}\") Details=\"\\\"C:\\\\ProgramData\\\\Package Cache\\\\*\" Details=\"*.exe\\\" /burn.runonce\") OR (Image IN (\"C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\*\", \"C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\Updates\\\\*\") Image=\"*\\\\OfficeClickToRun.exe\") OR Details=\"\\\"C:\\\\ProgramData\\\\Package Cache\\\\{d21a4f20-968a-4b0c-bf04-a38da5f06e41}\\\\windowsdesktop-runtime-*\" OR (Image=\"*\\\\VC_redist.x64.exe\" Details=\"*}\\\\VC_redist.x64.exe\\\" /burn.runonce\") OR (Image IN (\"C:\\\\ProgramData\\\\Package Cache*\", \"C:\\\\Windows\\\\Temp\\\\*\") Image IN (\"*\\\\winsdksetup.exe*\", \"*\\\\windowsdesktop-runtime-*\", \"*\\\\AspNetCoreSharedFrameworkBundle-*\") Details=\"* /burn.runonce\") OR (Image=\"C:\\\\Windows\\\\Installer\\\\MSI*\" TargetObject=\"*\\\\Explorer\\\\Browser Helper Objects*\") OR (Image=\"C:\\\\WINDOWS\\\\system32\\\\msiexec.exe\" TargetObject=\"*\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\*\")) | table SecurityID,ObjectName,OldValueType,NewValueType",
            "elastic": "(registry.path:*\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion* AND (registry.path:(*\\\\ShellServiceObjectDelayLoad* OR *\\\\Run\\\\* OR *\\\\RunOnce\\\\* OR *\\\\RunOnceEx\\\\* OR *\\\\RunServices\\\\* OR *\\\\RunServicesOnce\\\\* OR *\\\\Explorer\\\\ShellServiceObjects* OR *\\\\Explorer\\\\ShellIconOverlayIdentifiers* OR *\\\\Explorer\\\\ShellExecuteHooks* OR *\\\\Explorer\\\\SharedTaskScheduler* OR \"*\\\\Explorer\\\\Browser\\ Helper\\ Objects*\"))) AND (NOT (winlog.event_data.Details:\\(Empty\\) OR (process.executable:\"*C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\\\{*\" AND process.executable:*\\\\setup.exe*) OR (process.executable:\"C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\OfficeClickToRun.exe\" AND registry.path:*\\\\Office\\\\ClickToRun\\\\REGISTRY\\\\MACHINE\\\\Software\\\\Wow6432Node\\\\*) OR ((process.executable:(\"C\\:\\\\Program\\ Files\\\\Microsoft\\ Office\\\\root\\\\integration\\\\integrator.exe\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\ Office\\\\root\\\\integration\\\\integrator.exe\")) AND registry.path:\"*\\\\Explorer\\\\Browser\\ Helper\\ Objects\\\\\\{31D09BA0\\-12F5\\-4CCE\\-BE8A\\-2923E76605DA\\}\\\\*\") OR (winlog.event_data.Details:*\\-A251\\-47B7\\-93E1\\-CDD82E34AF8B\\} OR winlog.event_data.Details:\"grpconv\\ \\-o\" OR (winlog.event_data.Details:\"*C\\:\\\\Program\\ Files*\" AND winlog.event_data.Details:*\\\\Dropbox\\\\Client\\\\Dropbox.exe* AND winlog.event_data.Details:\"*\\ \\/systemstartup*\")) OR registry.path:\"*\\\\Explorer\\\\Browser\\ Helper\\ Objects\\\\\\{92EF2EAD\\-A7CE\\-4424\\-B0DB\\-499CF856608E\\}\\\\NoExplorer\" OR (process.executable:*\\\\windowsdesktop\\-runtime\\-* AND (registry.path:(*\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\\\{e2d1ae32\\-dd1d\\-4ad7\\-a298\\-10e42e7840fc\\} OR *\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\\\{7037b699\\-7382\\-448c\\-89a7\\-4765961d2537\\})) AND winlog.event_data.Details:\"\\\"C\\:\\\\ProgramData\\\\Package\\ Cache\\\\*\" AND winlog.event_data.Details:\"*.exe\\\"\\ \\/burn.runonce\") OR ((process.executable:(\"C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\*\" OR \"C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\Updates\\\\*\")) AND process.executable:*\\\\OfficeClickToRun.exe) OR winlog.event_data.Details:\"\\\"C\\:\\\\ProgramData\\\\Package\\ Cache\\\\\\{d21a4f20\\-968a\\-4b0c\\-bf04\\-a38da5f06e41\\}\\\\windowsdesktop\\-runtime\\-*\" OR (process.executable:*\\\\VC_redist.x64.exe AND winlog.event_data.Details:\"*\\}\\\\VC_redist.x64.exe\\\"\\ \\/burn.runonce\") OR ((process.executable:(\"C\\:\\\\ProgramData\\\\Package\\ Cache*\" OR C\\:\\\\Windows\\\\Temp\\\\*)) AND (process.executable:(*\\\\winsdksetup.exe* OR *\\\\windowsdesktop\\-runtime\\-* OR *\\\\AspNetCoreSharedFrameworkBundle\\-*)) AND winlog.event_data.Details:\"*\\ \\/burn.runonce\") OR (process.executable:C\\:\\\\Windows\\\\Installer\\\\MSI* AND registry.path:\"*\\\\Explorer\\\\Browser\\ Helper\\ Objects*\") OR (process.executable:C\\:\\\\WINDOWS\\\\system32\\\\msiexec.exe AND registry.path:*\\\\SOFTWARE\\\\Wow6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\*)))",
            "insightidr": "TargetObject ICONTAINS \"\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\" AND (TargetObject ICONTAINS-ANY [\"\\ShellServiceObjectDelayLoad\", \"\\Run\\\", \"\\RunOnce\\\", \"\\RunOnceEx\\\", \"\\RunServices\\\", \"\\RunServicesOnce\\\", \"\\Explorer\\ShellServiceObjects\", \"\\Explorer\\ShellIconOverlayIdentifiers\", \"\\Explorer\\ShellExecuteHooks\", \"\\Explorer\\SharedTaskScheduler\", \"\\Explorer\\Browser Helper Objects\"]) AND NOT (Details = NOCASE(\"(Empty)\") OR Image ICONTAINS-ALL [\"C:\\Program Files (x86)\\Microsoft\\EdgeUpdate\\Install\\{\", \"\\setup.exe\"] OR Image = NOCASE(\"C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\OfficeClickToRun.exe\") AND TargetObject ICONTAINS \"\\Office\\ClickToRun\\REGISTRY\\MACHINE\\Software\\Wow6432Node\\\" OR (Image IIN [\"C:\\Program Files\\Microsoft Office\\root\\integration\\integrator.exe\", \"C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe\"]) AND TargetObject ICONTAINS \"\\Explorer\\Browser Helper Objects\\{31D09BA0-12F5-4CCE-BE8A-2923E76605DA}\\\" OR Details=/.*\\-A251\\-47B7\\-93E1\\-CDD82E34AF8B\\}$/i OR Details = NOCASE(\"grpconv -o\") OR Details ICONTAINS-ALL [\"C:\\Program Files\", \"\\Dropbox\\Client\\Dropbox.exe\", \" /systemstartup\"] OR TargetObject=/.*\\\\Explorer\\\\Browser\\ Helper\\ Objects\\\\\\{92EF2EAD\\-A7CE\\-4424\\-B0DB\\-499CF856608E\\}\\\\NoExplorer$/i OR Image ICONTAINS \"\\windowsdesktop-runtime-\" AND (TargetObject=/(.*\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\\\{e2d1ae32\\-dd1d\\-4ad7\\-a298\\-10e42e7840fc\\}$|.*\\\\WOW6432Node\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\\\{7037b699\\-7382\\-448c\\-89a7\\-4765961d2537\\}$)/i) AND Details ISTARTS-WITH '\"C:\\ProgramData\\Package Cache\\' AND Details=/.*\\.exe\"\\ \\/burn\\.runonce$/i OR (Image ISTARTS-WITH-ANY [\"C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\\", \"C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\\"]) AND Image=/.*\\\\OfficeClickToRun\\.exe$/i OR Details ISTARTS-WITH '\"C:\\ProgramData\\Package Cache\\{d21a4f20-968a-4b0c-bf04-a38da5f06e41}\\windowsdesktop-runtime-' OR Image=/.*\\\\VC_redist\\.x64\\.exe$/i AND Details=/.*\\}\\\\VC_redist\\.x64\\.exe\"\\ \\/burn\\.runonce$/i OR (Image ISTARTS-WITH-ANY [\"C:\\ProgramData\\Package Cache\", \"C:\\Windows\\Temp\\\"]) AND (Image ICONTAINS-ANY [\"\\winsdksetup.exe\", \"\\windowsdesktop-runtime-\", \"\\AspNetCoreSharedFrameworkBundle-\"]) AND Details=/.*\\ \\/burn\\.runonce$/i OR Image ISTARTS-WITH \"C:\\Windows\\Installer\\MSI\" AND TargetObject ICONTAINS \"\\Explorer\\Browser Helper Objects\" OR Image = NOCASE(\"C:\\WINDOWS\\system32\\msiexec.exe\") AND TargetObject ICONTAINS \"\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\\")"
        },
        {
            "name": "CurrentVersion NT Autorun Keys Modification",
            "splunk": "TargetObject=\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion*\" TargetObject IN (\"*\\\\Winlogon\\\\VmApplet*\", \"*\\\\Winlogon\\\\Userinit*\", \"*\\\\Winlogon\\\\Taskman*\", \"*\\\\Winlogon\\\\Shell*\", \"*\\\\Winlogon\\\\GpExtensions*\", \"*\\\\Winlogon\\\\AppSetup*\", \"*\\\\Winlogon\\\\AlternateShells\\\\AvailableShells*\", \"*\\\\Windows\\\\IconServiceLib*\", \"*\\\\Windows\\\\Appinit_Dlls*\", \"*\\\\Image File Execution Options*\", \"*\\\\Font Drivers*\", \"*\\\\Drivers32*\", \"*\\\\Windows\\\\Run*\", \"*\\\\Windows\\\\Load*\") NOT (Details=\"(Empty)\" OR (TargetObject=\"*\\\\Image File Execution Options\\\\*\" TargetObject IN (\"*\\\\DisableExceptionChainValidation\", \"*\\\\MitigationOptions\")) OR (Image=\"C:\\\\Program Files (x86)\\\\Microsoft\\\\Temp\\\\*\" Image=\"*\\\\MicrosoftEdgeUpdate.exe\") OR TargetObject IN (\"*\\\\ClickToRunStore\\\\HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\*\", \"*\\\\ClickToRun\\\\REGISTRY\\\\MACHINE\\\\Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\*\") OR Image IN (\"C:\\\\Program Files\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\", \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\") OR (Image IN (\"C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\*\", \"C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\Updates\\\\*\") Image=\"*\\\\OfficeClickToRun.exe\") OR (Image=\"C:\\\\Windows\\\\system32\\\\svchost.exe\" TargetObject IN (\"*\\\\Winlogon\\\\GPExtensions\\\\{827D319E-6EAC-11D2-A4EA-00C04F79F83A}\\\\PreviousPolicyAreas*\", \"*\\\\Winlogon\\\\GPExtensions\\\\{827D319E-6EAC-11D2-A4EA-00C04F79F83A}\\\\MaxNoGPOListChangesInterval*\") Details IN (\"DWORD (0x00000009)\", \"DWORD (0x000003c0)\")) OR (Image=\"C:\\\\Windows\\\\Microsoft.NET\\\\Framework*\" Image=\"*\\\\ngen.exe\") OR (Image=\"*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup.exe\" TargetObject=\"*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\Delete Cached Update Binary\" Details=\"C:\\\\Windows\\\\system32\\\\cmd.exe /q /c del /q \\\"C:\\\\Users\\\\*\" Details=\"*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup.exe\\\"\")) | table SecurityID,ObjectName,OldValueType,NewValueType",
            "elastic": "registry.path:\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\ NT\\\\CurrentVersion*\" AND (registry.path:(*\\\\Winlogon\\\\VmApplet* OR *\\\\Winlogon\\\\Userinit* OR *\\\\Winlogon\\\\Taskman* OR *\\\\Winlogon\\\\Shell* OR *\\\\Winlogon\\\\GpExtensions* OR *\\\\Winlogon\\\\AppSetup* OR *\\\\Winlogon\\\\AlternateShells\\\\AvailableShells* OR *\\\\Windows\\\\IconServiceLib* OR *\\\\Windows\\\\Appinit_Dlls* OR \"*\\\\Image\\ File\\ Execution\\ Options*\" OR \"*\\\\Font\\ Drivers*\" OR *\\\\Drivers32* OR *\\\\Windows\\\\Run* OR *\\\\Windows\\\\Load*)) AND (NOT (winlog.event_data.Details:\\(Empty\\) OR (registry.path:\"*\\\\Image\\ File\\ Execution\\ Options\\\\*\" AND (registry.path:(*\\\\DisableExceptionChainValidation OR *\\\\MitigationOptions))) OR (process.executable:\"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\Temp\\\\*\" AND process.executable:*\\\\MicrosoftEdgeUpdate.exe) OR ((registry.path:(\"*\\\\ClickToRunStore\\\\HKLM\\\\SOFTWARE\\\\Microsoft\\\\Windows\\ NT\\\\CurrentVersion\\\\*\" OR \"*\\\\ClickToRun\\\\REGISTRY\\\\MACHINE\\\\Software\\\\Microsoft\\\\Windows\\ NT\\\\CurrentVersion\\\\*\")) OR (process.executable:(\"C\\:\\\\Program\\ Files\\\\Microsoft\\ Office\\\\root\\\\integration\\\\integrator.exe\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\ Office\\\\root\\\\integration\\\\integrator.exe\"))) OR ((process.executable:(\"C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\*\" OR \"C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\Updates\\\\*\")) AND process.executable:*\\\\OfficeClickToRun.exe) OR (process.executable:C\\:\\\\Windows\\\\system32\\\\svchost.exe AND (registry.path:(*\\\\Winlogon\\\\GPExtensions\\\\\\{827D319E\\-6EAC\\-11D2\\-A4EA\\-00C04F79F83A\\}\\\\PreviousPolicyAreas* OR *\\\\Winlogon\\\\GPExtensions\\\\\\{827D319E\\-6EAC\\-11D2\\-A4EA\\-00C04F79F83A\\}\\\\MaxNoGPOListChangesInterval*)) AND (winlog.event_data.Details:(\"DWORD\\ \\(0x00000009\\)\" OR \"DWORD\\ \\(0x000003c0\\)\"))) OR (process.executable:C\\:\\\\Windows\\\\Microsoft.NET\\\\Framework* AND process.executable:*\\\\ngen.exe) OR (process.executable:*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup.exe AND registry.path:\"*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\Delete\\ Cached\\ Update\\ Binary\" AND winlog.event_data.Details:\"C\\:\\\\Windows\\\\system32\\\\cmd.exe\\ \\/q\\ \\/c\\ del\\ \\/q\\ \\\"C\\:\\\\Users\\\\*\" AND winlog.event_data.Details:*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup.exe\\\")))",
            "insightidr": "TargetObject ICONTAINS \"\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\" AND (TargetObject ICONTAINS-ANY [\"\\Winlogon\\VmApplet\", \"\\Winlogon\\Userinit\", \"\\Winlogon\\Taskman\", \"\\Winlogon\\Shell\", \"\\Winlogon\\GpExtensions\", \"\\Winlogon\\AppSetup\", \"\\Winlogon\\AlternateShells\\AvailableShells\", \"\\Windows\\IconServiceLib\", \"\\Windows\\Appinit_Dlls\", \"\\Image File Execution Options\", \"\\Font Drivers\", \"\\Drivers32\", \"\\Windows\\Run\", \"\\Windows\\Load\"]) AND NOT (Details = NOCASE(\"(Empty)\") OR TargetObject ICONTAINS \"\\Image File Execution Options\\\" AND (TargetObject=/(.*\\\\DisableExceptionChainValidation$|.*\\\\MitigationOptions$)/i) OR Image ICONTAINS-ALL [\"C:\\Program Files (x86)\\Microsoft\\Temp\\\", \"\\MicrosoftEdgeUpdate.exe\"] OR TargetObject ICONTAINS-ANY [\"\\ClickToRunStore\\HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\\", \"\\ClickToRun\\REGISTRY\\MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\\"] OR Image IIN [\"C:\\Program Files\\Microsoft Office\\root\\integration\\integrator.exe\", \"C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe\"] OR (Image ISTARTS-WITH-ANY [\"C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\\", \"C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\\"]) AND Image=/.*\\\\OfficeClickToRun\\.exe$/i OR Image = NOCASE(\"C:\\Windows\\system32\\svchost.exe\") AND (TargetObject ICONTAINS-ANY [\"\\Winlogon\\GPExtensions\\{827D319E-6EAC-11D2-A4EA-00C04F79F83A}\\PreviousPolicyAreas\", \"\\Winlogon\\GPExtensions\\{827D319E-6EAC-11D2-A4EA-00C04F79F83A}\\MaxNoGPOListChangesInterval\"]) AND (Details IIN [\"DWORD (0x00000009)\", \"DWORD (0x000003c0)\"]) OR Image ICONTAINS-ALL [\"C:\\Windows\\Microsoft.NET\\Framework\", \"\\ngen.exe\"] OR Image=/.*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup\\.exe$/i AND TargetObject=/.*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\Delete\\ Cached\\ Update\\ Binary$/i AND Details ISTARTS-WITH 'C:\\Windows\\system32\\cmd.exe /q /c del /q \"C:\\Users\\' AND Details=/.*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup\\.exe\"$/i)"
        },
        {
            "name": "CurrentVersion Autorun Keys Modification",
            "splunk": "TargetObject=\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion*\" TargetObject IN (\"*\\\\ShellServiceObjectDelayLoad*\", \"*\\\\Run\\\\*\", \"*\\\\RunOnce\\\\*\", \"*\\\\RunOnceEx\\\\*\", \"*\\\\RunServices\\\\*\", \"*\\\\RunServicesOnce\\\\*\", \"*\\\\Policies\\\\System\\\\Shell*\", \"*\\\\Policies\\\\Explorer\\\\Run*\", \"*\\\\Group Policy\\\\Scripts\\\\Startup*\", \"*\\\\Group Policy\\\\Scripts\\\\Shutdown*\", \"*\\\\Group Policy\\\\Scripts\\\\Logon*\", \"*\\\\Group Policy\\\\Scripts\\\\Logoff*\", \"*\\\\Explorer\\\\ShellServiceObjects*\", \"*\\\\Explorer\\\\ShellIconOverlayIdentifiers*\", \"*\\\\Explorer\\\\ShellExecuteHooks*\", \"*\\\\Explorer\\\\SharedTaskScheduler*\", \"*\\\\Explorer\\\\Browser Helper Objects*\", \"*\\\\Authentication\\\\PLAP Providers*\", \"*\\\\Authentication\\\\Credential Providers*\", \"*\\\\Authentication\\\\Credential Provider Filters*\") NOT (Details=\"(Empty)\" OR TargetObject=\"*\\\\NgcFirst\\\\ConsecutiveSwitchCount\" OR Image IN (\"*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup.exe\", \"*\\\\AppData\\\\Roaming\\\\Spotify\\\\Spotify.exe\", \"*\\\\AppData\\\\Local\\\\WebEx\\\\WebexHost.exe\") OR Image IN (\"C:\\\\WINDOWS\\\\system32\\\\devicecensus.exe\", \"C:\\\\Windows\\\\system32\\\\winsat.exe\", \"C:\\\\Program Files\\\\Microsoft OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup.exe\", \"C:\\\\Program Files\\\\Microsoft OneDrive\\\\Update\\\\OneDriveSetup.exe\", \"C:\\\\Program Files (x86)\\\\Microsoft OneDrive\\\\Update\\\\OneDriveSetup.exe\", \"C:\\\\Program Files\\\\KeePass Password Safe 2\\\\ShInstUtil.exe\", \"C:\\\\Program Files\\\\Everything\\\\Everything.exe\", \"C:\\\\Program Files (x86)\\\\Microsoft Office\\\\root\\\\integration\\\\integrator.exe\") OR (Image=\"C:\\\\Windows\\\\system32\\\\LogonUI.exe\" TargetObject IN (\"*\\\\Authentication\\\\Credential Providers\\\\{D6886603-9D2F-4EB2-B667-1971041FA96B}\\\\*\", \"*\\\\Authentication\\\\Credential Providers\\\\{BEC09223-B018-416D-A0AC-523971B639F5}\\\\*\", \"*\\\\Authentication\\\\Credential Providers\\\\{8AF662BF-65A0-4D0A-A540-A338A999D36F}\\\\*\", \"*\\\\Authentication\\\\Credential Providers\\\\{27FBDB57-B613-4AF2-9D7E-4FA7A66C21AD}\\\\*\")) OR Image IN (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\*\", \"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\*\", \"C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe*\") OR (Image=\"C:\\\\Windows\\\\system32\\\\regsvr32.exe\" TargetObject=\"*DropboxExt*\" Details=\"*A251-47B7-93E1-CDD82E34AF8B}\") OR (TargetObject=\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Opera Browser Assistant\" Details=\"C:\\\\Program Files\\\\Opera\\\\assistant\\\\browser_assistant.exe\") OR (TargetObject=\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\iTunesHelper\" Details=\"\\\"C:\\\\Program Files\\\\iTunes\\\\iTunesHelper.exe\\\"\") OR (TargetObject=\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\zoommsirepair\" Details=\"\\\"C:\\\\Program Files\\\\Zoom\\\\bin\\\\installer.exe\\\" /repair\") OR (TargetObject=\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Greenshot\" Details=\"C:\\\\Program Files\\\\Greenshot\\\\Greenshot.exe\") OR (TargetObject=\"*\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\GoogleDriveFS\" Details=\"C:\\\\Program Files\\\\Google\\\\Drive File Stream\\\\*\" Details=\"*\\\\GoogleDriveFS.exe*\") OR (TargetObject=\"*GoogleDrive*\" Details IN (\"{CFE8B367-77A7-41D7-9C90-75D16D7DC6B6}\", \"{A8E52322-8734-481D-A7E2-27B309EF8D56}\", \"{C973DA94-CBDF-4E77-81D1-E5B794FBD146}\", \"{51EF1569-67EE-4AD6-9646-E726C3FFC8A2}\")) OR (Details IN (\"C:\\\\Windows\\\\system32\\\\cmd.exe /q /c rmdir /s /q \\\"C:\\\\Users\\\\*\", \"C:\\\\Windows\\\\system32\\\\cmd.exe /q /c del /q \\\"C:\\\\Users\\\\*\") Details=\"*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\*\") OR (TargetObject=\"*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\{*\" Details=\"*\\\\AppData\\\\Local\\\\Package Cache\\\\{*\" Details=\"*}\\\\python-*\" Details=\"*.exe\\\" /burn.runonce\") OR (Image IN (\"C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\*\", \"C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\ClickToRun\\\\Updates\\\\*\") Image=\"*\\\\OfficeClickToRun.exe\") OR Image=\"C:\\\\Program Files\\\\Windows Defender\\\\MsMpEng.exe\" OR (Image=\"*\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe\" Details=\"*\\\\Microsoft\\\\Teams\\\\Update.exe --processStart *\") OR (Image=\"C:\\\\Windows\\\\system32\\\\userinit.exe\" Details=\"ctfmon.exe /n\") OR (Image=\"C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\Setup\\\\*\" Details IN (\"\\\"C:\\\\Program Files\\\\AVG\\\\Antivirus\\\\AvLaunch.exe\\\" /gui\", \"\\\"C:\\\\Program Files (x86)\\\\AVG\\\\Antivirus\\\\AvLaunch.exe\\\" /gui\", \"{472083B0-C522-11CF-8763-00608CC02F24}\")) OR (Image IN (\"*\\\\aurora-agent-64.exe\", \"*\\\\aurora-agent.exe\") TargetObject=\"*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\aurora-dashboard\" Details=\"C:\\\\Program Files\\\\Aurora-Agent\\\\tools\\\\aurora-dashboard.exe\") OR (TargetObject=\"*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Everything\" Details=\"*\\\\Everything\\\\Everything.exe\\\" -startup\"))",
            "elastic": "(registry.path:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion* AND (registry.path:(*\\\\ShellServiceObjectDelayLoad* OR *\\\\Run\\\\* OR *\\\\RunOnce\\\\* OR *\\\\RunOnceEx\\\\* OR *\\\\RunServices\\\\* OR *\\\\RunServicesOnce\\\\* OR *\\\\Policies\\\\System\\\\Shell* OR *\\\\Policies\\\\Explorer\\\\Run* OR \"*\\\\Group\\ Policy\\\\Scripts\\\\Startup*\" OR \"*\\\\Group\\ Policy\\\\Scripts\\\\Shutdown*\" OR \"*\\\\Group\\ Policy\\\\Scripts\\\\Logon*\" OR \"*\\\\Group\\ Policy\\\\Scripts\\\\Logoff*\" OR *\\\\Explorer\\\\ShellServiceObjects* OR *\\\\Explorer\\\\ShellIconOverlayIdentifiers* OR *\\\\Explorer\\\\ShellExecuteHooks* OR *\\\\Explorer\\\\SharedTaskScheduler* OR \"*\\\\Explorer\\\\Browser\\ Helper\\ Objects*\" OR \"*\\\\Authentication\\\\PLAP\\ Providers*\" OR \"*\\\\Authentication\\\\Credential\\ Providers*\" OR \"*\\\\Authentication\\\\Credential\\ Provider\\ Filters*\"))) AND (NOT ((winlog.event_data.Details:\\(Empty\\) OR registry.path:*\\\\NgcFirst\\\\ConsecutiveSwitchCount OR (process.executable:(*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup.exe OR *\\\\AppData\\\\Roaming\\\\Spotify\\\\Spotify.exe OR *\\\\AppData\\\\Local\\\\WebEx\\\\WebexHost.exe)) OR (process.executable:(C\\:\\\\WINDOWS\\\\system32\\\\devicecensus.exe OR C\\:\\\\Windows\\\\system32\\\\winsat.exe OR \"C\\:\\\\Program\\ Files\\\\Microsoft\\ OneDrive\\\\StandaloneUpdater\\\\OneDriveSetup.exe\" OR \"C\\:\\\\Program\\ Files\\\\Microsoft\\ OneDrive\\\\Update\\\\OneDriveSetup.exe\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\ OneDrive\\\\Update\\\\OneDriveSetup.exe\" OR \"C\\:\\\\Program\\ Files\\\\KeePass\\ Password\\ Safe\\ 2\\\\ShInstUtil.exe\" OR \"C\\:\\\\Program\\ Files\\\\Everything\\\\Everything.exe\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\ Office\\\\root\\\\integration\\\\integrator.exe\"))) OR (process.executable:C\\:\\\\Windows\\\\system32\\\\LogonUI.exe AND (registry.path:(\"*\\\\Authentication\\\\Credential\\ Providers\\\\\\{D6886603\\-9D2F\\-4EB2\\-B667\\-1971041FA96B\\}\\\\*\" OR \"*\\\\Authentication\\\\Credential\\ Providers\\\\\\{BEC09223\\-B018\\-416D\\-A0AC\\-523971B639F5\\}\\\\*\" OR \"*\\\\Authentication\\\\Credential\\ Providers\\\\\\{8AF662BF\\-65A0\\-4D0A\\-A540\\-A338A999D36F\\}\\\\*\" OR \"*\\\\Authentication\\\\Credential\\ Providers\\\\\\{27FBDB57\\-B613\\-4AF2\\-9D7E\\-4FA7A66C21AD\\}\\\\*\"))) OR (process.executable:(\"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\*\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\EdgeWebView\\\\*\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe*\")) OR (process.executable:C\\:\\\\Windows\\\\system32\\\\regsvr32.exe AND registry.path:*DropboxExt* AND winlog.event_data.Details:*A251\\-47B7\\-93E1\\-CDD82E34AF8B\\}) OR (registry.path:\"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Opera\\ Browser\\ Assistant\" AND winlog.event_data.Details:\"C\\:\\\\Program\\ Files\\\\Opera\\\\assistant\\\\browser_assistant.exe\") OR (registry.path:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\iTunesHelper AND winlog.event_data.Details:\"\\\"C\\:\\\\Program\\ Files\\\\iTunes\\\\iTunesHelper.exe\\\"\") OR (registry.path:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\zoommsirepair AND winlog.event_data.Details:\"\\\"C\\:\\\\Program\\ Files\\\\Zoom\\\\bin\\\\installer.exe\\\"\\ \\/repair\") OR (registry.path:*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Greenshot AND winlog.event_data.Details:\"C\\:\\\\Program\\ Files\\\\Greenshot\\\\Greenshot.exe\") OR (registry.path:*\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\GoogleDriveFS AND winlog.event_data.Details:\"C\\:\\\\Program\\ Files\\\\Google\\\\Drive\\ File\\ Stream\\\\*\" AND winlog.event_data.Details:*\\\\GoogleDriveFS.exe*) OR (registry.path:*GoogleDrive* AND (winlog.event_data.Details:(\\{CFE8B367\\-77A7\\-41D7\\-9C90\\-75D16D7DC6B6\\} OR \\{A8E52322\\-8734\\-481D\\-A7E2\\-27B309EF8D56\\} OR \\{C973DA94\\-CBDF\\-4E77\\-81D1\\-E5B794FBD146\\} OR \\{51EF1569\\-67EE\\-4AD6\\-9646\\-E726C3FFC8A2\\}))) OR ((winlog.event_data.Details:(\"C\\:\\\\Windows\\\\system32\\\\cmd.exe\\ \\/q\\ \\/c\\ rmdir\\ \\/s\\ \\/q\\ \\\"C\\:\\\\Users\\\\*\" OR \"C\\:\\\\Windows\\\\system32\\\\cmd.exe\\ \\/q\\ \\/c\\ del\\ \\/q\\ \\\"C\\:\\\\Users\\\\*\")) AND winlog.event_data.Details:*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\*) OR (registry.path:*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\\\{* AND (winlog.event_data.Details:\"*\\\\AppData\\\\Local\\\\Package\\ Cache\\\\\\{*\" AND winlog.event_data.Details:*\\}\\\\python\\-*) AND winlog.event_data.Details:\"*.exe\\\"\\ \\/burn.runonce\") OR ((process.executable:(\"C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\*\" OR \"C\\:\\\\Program\\ Files\\\\Common\\ Files\\\\Microsoft\\ Shared\\\\ClickToRun\\\\Updates\\\\*\")) AND process.executable:*\\\\OfficeClickToRun.exe) OR process.executable:\"C\\:\\\\Program\\ Files\\\\Windows\\ Defender\\\\MsMpEng.exe\" OR (process.executable:*\\\\Microsoft\\\\Teams\\\\current\\\\Teams.exe AND winlog.event_data.Details:\"*\\\\Microsoft\\\\Teams\\\\Update.exe\\ \\-\\-processStart\\ *\") OR (process.executable:C\\:\\\\Windows\\\\system32\\\\userinit.exe AND winlog.event_data.Details:\"ctfmon.exe\\ \\/n\") OR (process.executable:\"C\\:\\\\Program\\ Files\\\\AVG\\\\Antivirus\\\\Setup\\\\*\" AND (winlog.event_data.Details:(\"\\\"C\\:\\\\Program\\ Files\\\\AVG\\\\Antivirus\\\\AvLaunch.exe\\\"\\ \\/gui\" OR \"\\\"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\AVG\\\\Antivirus\\\\AvLaunch.exe\\\"\\ \\/gui\" OR \\{472083B0\\-C522\\-11CF\\-8763\\-00608CC02F24\\}))) OR ((process.executable:(*\\\\aurora\\-agent\\-64.exe OR *\\\\aurora\\-agent.exe)) AND registry.path:*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\aurora\\-dashboard AND winlog.event_data.Details:\"C\\:\\\\Program\\ Files\\\\Aurora\\-Agent\\\\tools\\\\aurora\\-dashboard.exe\") OR (registry.path:*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Everything AND winlog.event_data.Details:\"*\\\\Everything\\\\Everything.exe\\\"\\ \\-startup\")))",
            "insightidr": "TargetObject ICONTAINS \"\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\" AND (TargetObject ICONTAINS-ANY [\"\\ShellServiceObjectDelayLoad\", \"\\Run\\\", \"\\RunOnce\\\", \"\\RunOnceEx\\\", \"\\RunServices\\\", \"\\RunServicesOnce\\\", \"\\Policies\\System\\Shell\", \"\\Policies\\Explorer\\Run\", \"\\Group Policy\\Scripts\\Startup\", \"\\Group Policy\\Scripts\\Shutdown\", \"\\Group Policy\\Scripts\\Logon\", \"\\Group Policy\\Scripts\\Logoff\", \"\\Explorer\\ShellServiceObjects\", \"\\Explorer\\ShellIconOverlayIdentifiers\", \"\\Explorer\\ShellExecuteHooks\", \"\\Explorer\\SharedTaskScheduler\", \"\\Explorer\\Browser Helper Objects\", \"\\Authentication\\PLAP Providers\", \"\\Authentication\\Credential Providers\", \"\\Authentication\\Credential Provider Filters\"]) AND NOT (Details = NOCASE(\"(Empty)\") OR TargetObject=/.*\\\\NgcFirst\\\\ConsecutiveSwitchCount$/i OR Image=/(.*\\\\AppData\\\\Local\\\\Microsoft\\\\OneDrive\\\\Update\\\\OneDriveSetup\\.exe$|.*\\\\AppData\\\\Roaming\\\\Spotify\\\\Spotify\\.exe$|.*\\\\AppData\\\\Local\\\\WebEx\\\\WebexHost\\.exe$)/i OR Image IIN [\"C:\\WINDOWS\\system32\\devicecensus.exe\", \"C:\\Windows\\system32\\winsat.exe\", \"C:\\Program Files\\Microsoft OneDrive\\StandaloneUpdater\\OneDriveSetup.exe\", \"C:\\Program Files\\Microsoft OneDrive\\Update\\OneDriveSetup.exe\", \"C:\\Program Files (x86)\\Microsoft OneDrive\\Update\\OneDriveSetup.exe\", \"C:\\Program Files\\KeePass Password Safe 2\\ShInstUtil.exe\", \"C:\\Program Files\\Everything\\Everything.exe\", \"C:\\Program Files (x86)\\Microsoft Office\\root\\integration\\integrator.exe\"] OR Image = NOCASE(\"C:\\Windows\\system32\\LogonUI.exe\") AND (TargetObject ICONTAINS-ANY [\"\\Authentication\\Credential Providers\\{D6886603-9D2F-4EB2-B667-1971041FA96B}\\\", \"\\Authentication\\Credential Providers\\{BEC09223-B018-416D-A0AC-523971B639F5}\\\", \"\\Authentication\\Credential Providers\\{8AF662BF-65A0-4D0A-A540-A338A999D36F}\\\", \"\\Authentication\\Credential Providers\\{27FBDB57-B613-4AF2-9D7E-4FA7A66C21AD}\\\"]) OR Image ISTARTS-WITH-ANY [\"C:\\Program Files (x86)\\Microsoft\\EdgeUpdate\\Install\\\", \"C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\\", \"C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe\"] OR Image = NOCASE(\"C:\\Windows\\system32\\regsvr32.exe\") AND TargetObject ICONTAINS \"DropboxExt\" AND Details=/.*A251\\-47B7\\-93E1\\-CDD82E34AF8B\\}$/i OR TargetObject=/.*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Opera\\ Browser\\ Assistant$/i AND Details = NOCASE(\"C:\\Program Files\\Opera\\assistant\\browser_assistant.exe\") OR TargetObject=/.*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\iTunesHelper$/i AND Details = NOCASE('\"C:\\Program Files\\iTunes\\iTunesHelper.exe\"') OR TargetObject=/.*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\\\\zoommsirepair$/i AND Details = NOCASE('\"C:\\Program Files\\Zoom\\bin\\installer.exe\" /repair') OR TargetObject=/.*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Greenshot$/i AND Details = NOCASE(\"C:\\Program Files\\Greenshot\\Greenshot.exe\") OR TargetObject=/.*\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\GoogleDriveFS$/i AND Details ISTARTS-WITH \"C:\\Program Files\\Google\\Drive File Stream\\\" AND Details ICONTAINS \"\\GoogleDriveFS.exe\" OR TargetObject ICONTAINS \"GoogleDrive\" AND (Details IIN [\"{CFE8B367-77A7-41D7-9C90-75D16D7DC6B6}\", \"{A8E52322-8734-481D-A7E2-27B309EF8D56}\", \"{C973DA94-CBDF-4E77-81D1-E5B794FBD146}\", \"{51EF1569-67EE-4AD6-9646-E726C3FFC8A2}\"]) OR (Details ISTARTS-WITH-ANY ['C:\\Windows\\system32\\cmd.exe /q /c rmdir /s /q \"C:\\Users\\', 'C:\\Windows\\system32\\cmd.exe /q /c del /q \"C:\\Users\\']) AND Details ICONTAINS \"\\AppData\\Local\\Microsoft\\OneDrive\\\" OR TargetObject ICONTAINS \"\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\{\" AND Details ICONTAINS-ALL [\"\\AppData\\Local\\Package Cache\\{\", \"}\\python-\"] AND Details=/.*\\.exe\"\\ \\/burn\\.runonce$/i OR (Image ISTARTS-WITH-ANY [\"C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\\", \"C:\\Program Files\\Common Files\\Microsoft Shared\\ClickToRun\\Updates\\\"]) AND Image=/.*\\\\OfficeClickToRun\\.exe$/i OR Image = NOCASE(\"C:\\Program Files\\Windows Defender\\MsMpEng.exe\") OR Image=/.*\\\\Microsoft\\\\Teams\\\\current\\\\Teams\\.exe$/i AND Details ICONTAINS \"\\Microsoft\\Teams\\Update.exe --processStart \" OR Image = NOCASE(\"C:\\Windows\\system32\\userinit.exe\") AND Details = NOCASE(\"ctfmon.exe /n\") OR Image ISTARTS-WITH \"C:\\Program Files\\AVG\\Antivirus\\Setup\\\" AND (Details IIN ['\"C:\\Program Files\\AVG\\Antivirus\\AvLaunch.exe\" /gui', '\"C:\\Program Files (x86)\\AVG\\Antivirus\\AvLaunch.exe\" /gui', \"{472083B0-C522-11CF-8763-00608CC02F24}\"]) OR (Image=/(.*\\\\aurora\\-agent\\-64\\.exe$|.*\\\\aurora\\-agent\\.exe$)/i) AND TargetObject=/.*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\aurora\\-dashboard$/i AND Details = NOCASE(\"C:\\Program Files\\Aurora-Agent\\tools\\aurora-dashboard.exe\") OR TargetObject=/.*\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\Everything$/i AND Details=/.*\\\\Everything\\\\Everything\\.exe\"\\ \\-startup$/i)"
        },
        {
            "name": "WmiPrvSE Spawned A Process",
            "splunk": "ParentImage=\"*\\\\WmiPrvSe.exe\" NOT (LogonId IN (\"0x3e7\", \"null\") OR User IN (\"*AUTHORI*\", \"*AUTORI*\") OR Image=\"*\\\\WmiPrvSE.exe\" OR Image=\"*\\\\WerFault.exe\" OR LogonId!=*)",
            "elastic": "process.parent.executable:*\\\\WmiPrvSe.exe AND (NOT ((winlog.event_data.LogonId:(0x3e7 OR null)) OR (winlog.event_data.User:(*AUTHORI* OR *AUTORI*)) OR process.executable:*\\\\WmiPrvSE.exe OR process.executable:*\\\\WerFault.exe OR (NOT _exists_:winlog.event_data.LogonId)))",
            "insightidr": "ParentImage=/.*\\\\WmiPrvSe\\.exe$/i AND NOT (LogonId IIN [\"0x3e7\", \"null\"] OR User ICONTAINS-ANY [\"AUTHORI\", \"AUTORI\"] OR Image=/.*\\\\WmiPrvSE\\.exe$/i OR Image=/.*\\\\WerFault\\.exe$/i OR LogonId = null)"
        },
        {
            "name": "Use of W32tm as Timer",
            "splunk": "Image=\"*\\\\w32tm.exe\" OR OriginalFileName=\"w32time.dll\" CommandLine=\"*/stripchart*\" CommandLine=\"*/computer:*\" CommandLine=\"*/period:*\" CommandLine=\"*/dataonly*\" CommandLine=\"*/samples:*\"",
            "elastic": "(process.executable:*\\\\w32tm.exe OR process.pe.original_file_name:w32time.dll) AND (process.command_line:*\\/stripchart* AND process.command_line:*\\/computer\\:* AND process.command_line:*\\/period\\:* AND process.command_line:*\\/dataonly* AND process.command_line:*\\/samples\\:*)",
            "insightidr": "(Image=/.*\\\\w32tm\\.exe$/i OR OriginalFileName = NOCASE(\"w32time.dll\")) AND CommandLine ICONTAINS-ALL [\"/stripchart\", \"/computer:\", \"/period:\", \"/dataonly\", \"/samples:\"]"
        },
        {
            "name": "Uncommon Userinit Child Process",
            "splunk": "ParentImage=\"*\\\\userinit.exe\" NOT Image=\"*:\\\\WINDOWS\\\\explorer.exe\" NOT (CommandLine IN (\"*netlogon.bat*\", \"*UsrLogon.cmd*\") OR CommandLine=\"PowerShell.exe\" OR Image IN (\"*:\\\\Windows\\\\System32\\\\proquota.exe\", \"*:\\\\Windows\\\\SysWOW64\\\\proquota.exe\") OR Image IN (\"*:\\\\Program Files (x86)\\\\Citrix\\\\HDX\\\\bin\\\\cmstart.exe\", \"*:\\\\Program Files (x86)\\\\Citrix\\\\HDX\\\\bin\\\\icast.exe\", \"*:\\\\Program Files (x86)\\\\Citrix\\\\System32\\\\icast.exe\", \"*:\\\\Program Files\\\\Citrix\\\\HDX\\\\bin\\\\cmstart.exe\", \"*:\\\\Program Files\\\\Citrix\\\\HDX\\\\bin\\\\icast.exe\", \"*:\\\\Program Files\\\\Citrix\\\\System32\\\\icast.exe\") OR Image!=*)",
            "elastic": "process.parent.executable:*\\\\userinit.exe AND (NOT process.executable:*\\:\\\\WINDOWS\\\\explorer.exe) AND (NOT ((process.command_line:(*netlogon.bat* OR *UsrLogon.cmd*)) OR process.command_line:PowerShell.exe OR (process.executable:(*\\:\\\\Windows\\\\System32\\\\proquota.exe OR *\\:\\\\Windows\\\\SysWOW64\\\\proquota.exe)) OR (process.executable:(\"*\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Citrix\\\\HDX\\\\bin\\\\cmstart.exe\" OR \"*\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Citrix\\\\HDX\\\\bin\\\\icast.exe\" OR \"*\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Citrix\\\\System32\\\\icast.exe\" OR \"*\\:\\\\Program\\ Files\\\\Citrix\\\\HDX\\\\bin\\\\cmstart.exe\" OR \"*\\:\\\\Program\\ Files\\\\Citrix\\\\HDX\\\\bin\\\\icast.exe\" OR \"*\\:\\\\Program\\ Files\\\\Citrix\\\\System32\\\\icast.exe\")) OR (NOT _exists_:process.executable)))",
            "insightidr": "ParentImage=/.*\\\\userinit\\.exe$/i AND NOT Image=/.*:\\\\WINDOWS\\\\explorer\\.exe$/i AND NOT (CommandLine ICONTAINS-ANY [\"netlogon.bat\", \"UsrLogon.cmd\"] OR CommandLine = NOCASE(\"PowerShell.exe\") OR Image=/(.*:\\\\Windows\\\\System32\\\\proquota\\.exe$|.*:\\\\Windows\\\\SysWOW64\\\\proquota\\.exe$)/i OR Image=/(.*:\\\\Program\\ Files\\ \\(x86\\)\\\\Citrix\\\\HDX\\\\bin\\\\cmstart\\.exe$|.*:\\\\Program\\ Files\\ \\(x86\\)\\\\Citrix\\\\HDX\\\\bin\\\\icast\\.exe$|.*:\\\\Program\\ Files\\ \\(x86\\)\\\\Citrix\\\\System32\\\\icast\\.exe$|.*:\\\\Program\\ Files\\\\Citrix\\\\HDX\\\\bin\\\\cmstart\\.exe$|.*:\\\\Program\\ Files\\\\Citrix\\\\HDX\\\\bin\\\\icast\\.exe$|.*:\\\\Program\\ Files\\\\Citrix\\\\System32\\\\icast\\.exe$)/i OR Image = null)"
        },
        {
            "name": "Suspicious Tasklist Discovery Command",
            "splunk": "CommandLine=\"*tasklist*\" OR Image=\"*\\\\tasklist.exe\" OR OriginalFileName=\"tasklist.exe\"",
            "elastic": "process.command_line:*tasklist* OR process.executable:*\\\\tasklist.exe OR process.pe.original_file_name:tasklist.exe",
            "insightidr": "CommandLine ICONTAINS \"tasklist\" OR Image=/.*\\\\tasklist\\.exe$/i OR OriginalFileName = NOCASE(\"tasklist.exe\")"
        },
        {
            "name": "Suspect Svchost Activity",
            "splunk": "CommandLine=\"*svchost.exe\" Image=\"*\\\\svchost.exe\" NOT (ParentImage IN (\"*\\\\rpcnet.exe\", \"*\\\\rpcnetp.exe\") OR CommandLine!=*) | table CommandLine,ParentCommandLine",
            "elastic": "(process.command_line:*svchost.exe AND process.executable:*\\\\svchost.exe) AND (NOT ((process.parent.executable:(*\\\\rpcnet.exe OR *\\\\rpcnetp.exe)) OR (NOT _exists_:process.command_line)))",
            "insightidr": "CommandLine=/.*svchost\\.exe$/i AND Image=/.*\\\\svchost\\.exe$/i AND NOT (ParentImage=/(.*\\\\rpcnet\\.exe$|.*\\\\rpcnetp\\.exe$)/i OR CommandLine = null)"
        },
        {
            "name": "Process Creation Using Sysnative Folder",
            "splunk": "CommandLine=\"*:\\\\Windows\\\\Sysnative\\\\*\" OR Image=\"*:\\\\Windows\\\\Sysnative\\\\*\"",
            "elastic": "process.command_line:*\\:\\\\Windows\\\\Sysnative\\\\* OR process.executable:*\\:\\\\Windows\\\\Sysnative\\\\*",
            "insightidr": "CommandLine ICONTAINS \":\\Windows\\Sysnative\\\" OR Image ICONTAINS \":\\Windows\\Sysnative\\\""
        },
        {
            "name": "Windows Shell/Scripting Processes Spawning Suspicious Programs",
            "splunk": "ParentImage IN (\"*\\\\mshta.exe\", \"*\\\\powershell.exe\", \"*\\\\pwsh.exe\", \"*\\\\rundll32.exe\", \"*\\\\cscript.exe\", \"*\\\\wscript.exe\", \"*\\\\wmiprvse.exe\", \"*\\\\regsvr32.exe\") Image IN (\"*\\\\schtasks.exe\", \"*\\\\nslookup.exe\", \"*\\\\certutil.exe\", \"*\\\\bitsadmin.exe\", \"*\\\\mshta.exe\") NOT (CurrentDirectory=\"*\\\\ccmcache\\\\*\" OR ParentCommandLine IN (\"*\\\\Program Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\setup-scheduledtask.ps1*\", \"*\\\\Program Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\set-selfhealing.ps1*\", \"*\\\\Program Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\check-workspacehealth.ps1*\", \"*\\\\nessus_*\") OR CommandLine=\"*\\\\nessus_*\" OR (ParentImage=\"*\\\\mshta.exe\" Image=\"*\\\\mshta.exe\" ParentCommandLine=\"*C:\\\\MEM_Configmgr_*\" ParentCommandLine=\"*\\\\splash.hta*\" ParentCommandLine=\"*{1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}*\" CommandLine=\"*C:\\\\MEM_Configmgr_*\" CommandLine=\"*\\\\SMSSETUP\\\\BIN\\\\*\" CommandLine=\"*\\\\autorun.hta*\" CommandLine=\"*{1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}*\")) | table CommandLine,ParentCommandLine,CurrentDirectory,Image,ParentImage",
            "elastic": "((process.parent.executable:(*\\\\mshta.exe OR *\\\\powershell.exe OR *\\\\pwsh.exe OR *\\\\rundll32.exe OR *\\\\cscript.exe OR *\\\\wscript.exe OR *\\\\wmiprvse.exe OR *\\\\regsvr32.exe)) AND (process.executable:(*\\\\schtasks.exe OR *\\\\nslookup.exe OR *\\\\certutil.exe OR *\\\\bitsadmin.exe OR *\\\\mshta.exe))) AND (NOT (process.working_directory:*\\\\ccmcache\\\\* OR (process.parent.command_line:(\"*\\\\Program\\ Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\setup\\-scheduledtask.ps1*\" OR \"*\\\\Program\\ Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\set\\-selfhealing.ps1*\" OR \"*\\\\Program\\ Files\\\\Amazon\\\\WorkSpacesConfig\\\\Scripts\\\\check\\-workspacehealth.ps1*\" OR *\\\\nessus_*)) OR process.command_line:*\\\\nessus_* OR (process.parent.executable:*\\\\mshta.exe AND process.executable:*\\\\mshta.exe AND (process.parent.command_line:*C\\:\\\\MEM_Configmgr_* AND process.parent.command_line:*\\\\splash.hta* AND process.parent.command_line:*\\{1E460BD7\\-F1C3\\-4B2E\\-88BF\\-4E770A288AF5\\}*) AND (process.command_line:*C\\:\\\\MEM_Configmgr_* AND process.command_line:*\\\\SMSSETUP\\\\BIN\\\\* AND process.command_line:*\\\\autorun.hta* AND process.command_line:*\\{1E460BD7\\-F1C3\\-4B2E\\-88BF\\-4E770A288AF5\\}*))))",
            "insightidr": "(ParentImage=/(.*\\\\mshta\\.exe$|.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$|.*\\\\rundll32\\.exe$|.*\\\\cscript\\.exe$|.*\\\\wscript\\.exe$|.*\\\\wmiprvse\\.exe$|.*\\\\regsvr32\\.exe$)/i) AND (Image=/(.*\\\\schtasks\\.exe$|.*\\\\nslookup\\.exe$|.*\\\\certutil\\.exe$|.*\\\\bitsadmin\\.exe$|.*\\\\mshta\\.exe$)/i) AND NOT (CurrentDirectory ICONTAINS \"\\ccmcache\\\" OR ParentCommandLine ICONTAINS-ANY [\"\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\setup-scheduledtask.ps1\", \"\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\set-selfhealing.ps1\", \"\\Program Files\\Amazon\\WorkSpacesConfig\\Scripts\\check-workspacehealth.ps1\", \"\\nessus_\"] OR CommandLine ICONTAINS \"\\nessus_\" OR ParentImage=/.*\\\\mshta\\.exe$/i AND Image=/.*\\\\mshta\\.exe$/i AND ParentCommandLine ICONTAINS-ALL [\"C:\\MEM_Configmgr_\", \"\\splash.hta\", \"{1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}\"] AND CommandLine ICONTAINS-ALL [\"C:\\MEM_Configmgr_\", \"\\SMSSETUP\\BIN\\\", \"\\autorun.hta\", \"{1E460BD7-F1C3-4B2E-88BF-4E770A288AF5}\"])"
        },
        {
            "name": "Suspicious New Service Creation",
            "splunk": "(Image=\"*\\\\sc.exe\" CommandLine=\"*create*\" CommandLine=\"*binPath=*\") OR (CommandLine=\"*New-Service*\" CommandLine=\"*-BinaryPathName*\") CommandLine IN (\"*powershell*\", \"*mshta*\", \"*wscript*\", \"*cscript*\", \"*svchost*\", \"*dllhost*\", \"*cmd *\", \"*cmd.exe /c*\", \"*cmd.exe /k*\", \"*cmd.exe /r*\", \"*rundll32*\", \"*C:\\\\Users\\\\Public*\", \"*\\\\Downloads\\\\*\", \"*\\\\Desktop\\\\*\", \"*\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\*\", \"*C:\\\\Windows\\\\TEMP\\\\*\", \"*\\\\AppData\\\\Local\\\\Temp*\")",
            "elastic": "((process.executable:*\\\\sc.exe AND (process.command_line:*create* AND process.command_line:*binPath\\=*)) OR (process.command_line:*New\\-Service* AND process.command_line:*\\-BinaryPathName*)) AND (process.command_line:(*powershell* OR *mshta* OR *wscript* OR *cscript* OR *svchost* OR *dllhost* OR \"*cmd\\ *\" OR \"*cmd.exe\\ \\/c*\" OR \"*cmd.exe\\ \\/k*\" OR \"*cmd.exe\\ \\/r*\" OR *rundll32* OR *C\\:\\\\Users\\\\Public* OR *\\\\Downloads\\\\* OR *\\\\Desktop\\\\* OR \"*\\\\Microsoft\\\\Windows\\\\Start\\ Menu\\\\Programs\\\\Startup\\\\*\" OR *C\\:\\\\Windows\\\\TEMP\\\\* OR *\\\\AppData\\\\Local\\\\Temp*))",
            "insightidr": "(Image=/.*\\\\sc\\.exe$/i AND CommandLine ICONTAINS-ALL [\"create\", \"binPath=\"] OR CommandLine ICONTAINS-ALL [\"New-Service\", \"-BinaryPathName\"]) AND (CommandLine ICONTAINS-ANY [\"powershell\", \"mshta\", \"wscript\", \"cscript\", \"svchost\", \"dllhost\", \"cmd \", \"cmd.exe /c\", \"cmd.exe /k\", \"cmd.exe /r\", \"rundll32\", \"C:\\Users\\Public\", \"\\Downloads\\\", \"\\Desktop\\\", \"\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\\", \"C:\\Windows\\TEMP\\\", \"\\AppData\\Local\\Temp\"])"
        },
        {
            "name": "Suspicious Script Execution From Temp Folder",
            "splunk": "Image IN (\"*\\\\powershell.exe\", \"*\\\\pwsh.exe\", \"*\\\\mshta.exe\", \"*\\\\wscript.exe\", \"*\\\\cscript.exe\") CommandLine IN (\"*\\\\Windows\\\\Temp*\", \"*\\\\Temporary Internet*\", \"*\\\\AppData\\\\Local\\\\Temp*\", \"*\\\\AppData\\\\Roaming\\\\Temp*\", \"*%TEMP%*\", \"*%TMP%*\", \"*%LocalAppData%\\\\Temp*\") NOT (CommandLine IN (\"* >*\", \"*Out-File*\", \"*ConvertTo-Json*\", \"*-WindowStyle hidden -Verb runAs*\", \"*\\\\Windows\\\\system32\\\\config\\\\systemprofile\\\\AppData\\\\Local\\\\Temp\\\\Amazon\\\\EC2-Windows\\\\*\"))",
            "elastic": "((process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe OR *\\\\mshta.exe OR *\\\\wscript.exe OR *\\\\cscript.exe)) AND (process.command_line:(*\\\\Windows\\\\Temp* OR \"*\\\\Temporary\\ Internet*\" OR *\\\\AppData\\\\Local\\\\Temp* OR *\\\\AppData\\\\Roaming\\\\Temp* OR *%TEMP%* OR *%TMP%* OR *%LocalAppData%\\\\Temp*))) AND (NOT (process.command_line:(\"*\\ \\>*\" OR *Out\\-File* OR *ConvertTo\\-Json* OR \"*\\-WindowStyle\\ hidden\\ \\-Verb\\ runAs*\" OR *\\\\Windows\\\\system32\\\\config\\\\systemprofile\\\\AppData\\\\Local\\\\Temp\\\\Amazon\\\\EC2\\-Windows\\\\*)))",
            "insightidr": "(Image=/(.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$|.*\\\\mshta\\.exe$|.*\\\\wscript\\.exe$|.*\\\\cscript\\.exe$)/i) AND (CommandLine ICONTAINS-ANY [\"\\Windows\\Temp\", \"\\Temporary Internet\", \"\\AppData\\Local\\Temp\", \"\\AppData\\Roaming\\Temp\", \"%TEMP%\", \"%TMP%\", \"%LocalAppData%\\Temp\"]) AND NOT (CommandLine ICONTAINS-ANY [\" >\", \"Out-File\", \"ConvertTo-Json\", \"-WindowStyle hidden -Verb runAs\", \"\\Windows\\system32\\config\\systemprofile\\AppData\\Local\\Temp\\Amazon\\EC2-Windows\\\"])"
        },
        {
            "name": "Windows Processes Suspicious Parent Directory",
            "splunk": "Image IN (\"*\\\\svchost.exe\", \"*\\\\taskhost.exe\", \"*\\\\lsm.exe\", \"*\\\\lsass.exe\", \"*\\\\services.exe\", \"*\\\\lsaiso.exe\", \"*\\\\csrss.exe\", \"*\\\\wininit.exe\", \"*\\\\winlogon.exe\") NOT (ParentImage IN (\"*\\\\SavService.exe\", \"*\\\\ngen.exe\") OR ParentImage IN (\"*\\\\System32\\\\*\", \"*\\\\SysWOW64\\\\*\") OR (ParentImage IN (\"*\\\\Windows Defender\\\\*\", \"*\\\\Microsoft Security Client\\\\*\") ParentImage=\"*\\\\MsMpEng.exe\") OR ParentImage!=* OR ParentImage=\"-\")",
            "elastic": "(process.executable:(*\\\\svchost.exe OR *\\\\taskhost.exe OR *\\\\lsm.exe OR *\\\\lsass.exe OR *\\\\services.exe OR *\\\\lsaiso.exe OR *\\\\csrss.exe OR *\\\\wininit.exe OR *\\\\winlogon.exe)) AND (NOT (((process.parent.executable:(*\\\\SavService.exe OR *\\\\ngen.exe)) OR (process.parent.executable:(*\\\\System32\\\\* OR *\\\\SysWOW64\\\\*))) OR ((process.parent.executable:(\"*\\\\Windows\\ Defender\\\\*\" OR \"*\\\\Microsoft\\ Security\\ Client\\\\*\")) AND process.parent.executable:*\\\\MsMpEng.exe) OR ((NOT _exists_:process.parent.executable) OR process.parent.executable:\\-)))",
            "insightidr": "(Image=/(.*\\\\svchost\\.exe$|.*\\\\taskhost\\.exe$|.*\\\\lsm\\.exe$|.*\\\\lsass\\.exe$|.*\\\\services\\.exe$|.*\\\\lsaiso\\.exe$|.*\\\\csrss\\.exe$|.*\\\\wininit\\.exe$|.*\\\\winlogon\\.exe$)/i) AND NOT (ParentImage=/(.*\\\\SavService\\.exe$|.*\\\\ngen\\.exe$)/i OR ParentImage ICONTAINS-ANY [\"\\System32\\\", \"\\SysWOW64\\\"] OR (ParentImage ICONTAINS-ANY [\"\\Windows Defender\\\", \"\\Microsoft Security Client\\\"]) AND ParentImage=/.*\\\\MsMpEng\\.exe$/i OR ParentImage = null OR ParentImage = NOCASE(\"-\"))"
        },
        {
            "name": "Suspicious Process Parents",
            "splunk": "ParentImage IN (\"*\\\\minesweeper.exe\", \"*\\\\winver.exe\", \"*\\\\bitsadmin.exe\") OR (ParentImage IN (\"*\\\\csrss.exe\", \"*\\\\certutil.exe\", \"*\\\\eventvwr.exe\", \"*\\\\calc.exe\", \"*\\\\notepad.exe\") NOT (Image IN (\"*\\\\WerFault.exe\", \"*\\\\wermgr.exe\", \"*\\\\conhost.exe\", \"*\\\\mmc.exe\", \"*\\\\win32calc.exe\", \"*\\\\notepad.exe\") OR Image!=*))",
            "elastic": "(process.parent.executable:(*\\\\minesweeper.exe OR *\\\\winver.exe OR *\\\\bitsadmin.exe)) OR ((process.parent.executable:(*\\\\csrss.exe OR *\\\\certutil.exe OR *\\\\eventvwr.exe OR *\\\\calc.exe OR *\\\\notepad.exe)) AND (NOT ((process.executable:(*\\\\WerFault.exe OR *\\\\wermgr.exe OR *\\\\conhost.exe OR *\\\\mmc.exe OR *\\\\win32calc.exe OR *\\\\notepad.exe)) OR (NOT _exists_:process.executable))))",
            "insightidr": "ParentImage=/(.*\\\\minesweeper\\.exe$|.*\\\\winver\\.exe$|.*\\\\bitsadmin\\.exe$)/i OR (ParentImage=/(.*\\\\csrss\\.exe$|.*\\\\certutil\\.exe$|.*\\\\eventvwr\\.exe$|.*\\\\calc\\.exe$|.*\\\\notepad\\.exe$)/i) AND NOT (Image=/(.*\\\\WerFault\\.exe$|.*\\\\wermgr\\.exe$|.*\\\\conhost\\.exe$|.*\\\\mmc\\.exe$|.*\\\\win32calc\\.exe$|.*\\\\notepad\\.exe$)/i OR Image = null)"
        },
        {
            "name": "Use Short Name Path in Command Line",
            "splunk": "CommandLine IN (\"*~1\\\\*\", \"*~2\\\\*\") NOT (ParentImage IN (\"C:\\\\Windows\\\\System32\\\\Dism.exe\", \"C:\\\\Windows\\\\System32\\\\cleanmgr.exe\", \"C:\\\\Program Files\\\\GPSoftware\\\\Directory Opus\\\\dopus.exe\") OR ParentImage IN (\"*\\\\WebEx\\\\WebexHost.exe\", \"*\\\\thor\\\\thor64.exe\", \"*\\\\veam.backup.shell.exe\", \"*\\\\winget.exe\", \"*\\\\Everything\\\\Everything.exe\") OR ParentImage=\"*\\\\AppData\\\\Local\\\\Temp\\\\WinGet\\\\*\" OR CommandLine IN (\"*\\\\appdata\\\\local\\\\webex\\\\webex64\\\\meetings\\\\wbxreport.exe*\", \"*C:\\\\Program Files\\\\Git\\\\post-install.bat*\", \"*C:\\\\Program Files\\\\Git\\\\cmd\\\\scalar.exe*\"))",
            "elastic": "(process.command_line:(*\\~1\\\\* OR *\\~2\\\\*)) AND (NOT ((process.parent.executable:(C\\:\\\\Windows\\\\System32\\\\Dism.exe OR C\\:\\\\Windows\\\\System32\\\\cleanmgr.exe OR \"C\\:\\\\Program\\ Files\\\\GPSoftware\\\\Directory\\ Opus\\\\dopus.exe\")) OR (process.parent.executable:(*\\\\WebEx\\\\WebexHost.exe OR *\\\\thor\\\\thor64.exe OR *\\\\veam.backup.shell.exe OR *\\\\winget.exe OR *\\\\Everything\\\\Everything.exe)) OR process.parent.executable:*\\\\AppData\\\\Local\\\\Temp\\\\WinGet\\\\* OR (process.command_line:(*\\\\appdata\\\\local\\\\webex\\\\webex64\\\\meetings\\\\wbxreport.exe* OR \"*C\\:\\\\Program\\ Files\\\\Git\\\\post\\-install.bat*\" OR \"*C\\:\\\\Program\\ Files\\\\Git\\\\cmd\\\\scalar.exe*\"))))",
            "insightidr": "(CommandLine ICONTAINS-ANY [\"~1\\\", \"~2\\\"]) AND NOT (ParentImage IIN [\"C:\\Windows\\System32\\Dism.exe\", \"C:\\Windows\\System32\\cleanmgr.exe\", \"C:\\Program Files\\GPSoftware\\Directory Opus\\dopus.exe\"] OR ParentImage=/(.*\\\\WebEx\\\\WebexHost\\.exe$|.*\\\\thor\\\\thor64\\.exe$|.*\\\\veam\\.backup\\.shell\\.exe$|.*\\\\winget\\.exe$|.*\\\\Everything\\\\Everything\\.exe$)/i OR ParentImage ICONTAINS \"\\AppData\\Local\\Temp\\WinGet\\\" OR CommandLine ICONTAINS-ANY [\"\\appdata\\local\\webex\\webex64\\meetings\\wbxreport.exe\", \"C:\\Program Files\\Git\\post-install.bat\", \"C:\\Program Files\\Git\\cmd\\scalar.exe\"])"
        },
        {
            "name": "LOLBIN Execution From Abnormal Drive",
            "splunk": "Image IN (\"*\\\\calc.exe\", \"*\\\\certutil.exe\", \"*\\\\cmstp.exe\", \"*\\\\cscript.exe\", \"*\\\\installutil.exe\", \"*\\\\mshta.exe\", \"*\\\\regsvr32.exe\", \"*\\\\rundll32.exe\", \"*\\\\wscript.exe\") OR OriginalFileName IN (\"CALC.EXE\", \"CertUtil.exe\", \"CMSTP.EXE\", \"cscript.exe\", \"installutil.exe\", \"MSHTA.EXE\", \"REGSVR32.EXE\", \"RUNDLL32.EXE\", \"wscript.exe\") NOT (CurrentDirectory=\"*C:\\\\*\" OR CurrentDirectory=\"\" OR CurrentDirectory!=*)",
            "elastic": "((process.executable:(*\\\\calc.exe OR *\\\\certutil.exe OR *\\\\cmstp.exe OR *\\\\cscript.exe OR *\\\\installutil.exe OR *\\\\mshta.exe OR *\\\\regsvr32.exe OR *\\\\rundll32.exe OR *\\\\wscript.exe)) OR (process.pe.original_file_name:(CALC.EXE OR CertUtil.exe OR CMSTP.EXE OR cscript.exe OR installutil.exe OR MSHTA.EXE OR REGSVR32.EXE OR RUNDLL32.EXE OR wscript.exe))) AND (NOT (process.working_directory:*C\\:\\\\* OR process.working_directory:\"\" OR (NOT _exists_:process.working_directory)))",
            "insightidr": "(Image=/(.*\\\\calc\\.exe$|.*\\\\certutil\\.exe$|.*\\\\cmstp\\.exe$|.*\\\\cscript\\.exe$|.*\\\\installutil\\.exe$|.*\\\\mshta\\.exe$|.*\\\\regsvr32\\.exe$|.*\\\\rundll32\\.exe$|.*\\\\wscript\\.exe$)/i OR OriginalFileName IIN [\"CALC.EXE\", \"CertUtil.exe\", \"CMSTP.EXE\", \"cscript.exe\", \"installutil.exe\", \"MSHTA.EXE\", \"REGSVR32.EXE\", \"RUNDLL32.EXE\", \"wscript.exe\"]) AND NOT (CurrentDirectory ICONTAINS \"C:\\\" OR CurrentDirectory = NOCASE(\"\") OR CurrentDirectory = null)"
        },
        {
            "name": "Elevated System Shell Spawned From Uncommon Parent Location",
            "splunk": "Image IN (\"*\\\\powershell.exe\", \"*\\\\pwsh.exe\", \"*\\\\cmd.exe\") OR OriginalFileName IN (\"PowerShell.EXE\", \"pwsh.dll\", \"Cmd.Exe\") User IN (\"*AUTHORI*\", \"*AUTORI*\") LogonId=\"0x3e7\" NOT (ParentImage IN (\"*:\\\\Program Files (x86)\\\\*\", \"*:\\\\Program Files\\\\*\", \"*:\\\\ProgramData\\\\*\", \"*:\\\\Windows\\\\System32\\\\*\", \"*:\\\\Windows\\\\SysWOW64\\\\*\", \"*:\\\\Windows\\\\Temp\\\\*\", \"*:\\\\Windows\\\\WinSxS\\\\*\") OR ParentImage!=* OR ParentImage=\"\") NOT ((ParentImage=\"*:\\\\ManageEngine\\\\ADManager Plus\\\\pgsql\\\\bin\\\\postgres.exe\" Image=\"*\\\\cmd.exe\") OR (CommandLine=\"*:\\\\WINDOWS\\\\system32\\\\cmd.exe /c \\\"*\" CurrentDirectory=\"*:\\\\WINDOWS\\\\Temp\\\\asgard2-agent\\\\*\") OR (ParentImage=\"*:\\\\IBM\\\\SpectrumProtect\\\\webserver\\\\scripts\\\\*\" CommandLine=\"*:\\\\IBM\\\\SpectrumProtect\\\\webserver\\\\scripts\\\\*\"))",
            "elastic": "(((process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe OR *\\\\cmd.exe)) OR (process.pe.original_file_name:(PowerShell.EXE OR pwsh.dll OR Cmd.Exe))) AND ((winlog.event_data.User:(*AUTHORI* OR *AUTORI*)) AND winlog.event_data.LogonId:0x3e7)) AND (NOT ((process.parent.executable:(\"*\\:\\\\Program\\ Files\\ \\(x86\\)\\\\*\" OR \"*\\:\\\\Program\\ Files\\\\*\" OR *\\:\\\\ProgramData\\\\* OR *\\:\\\\Windows\\\\System32\\\\* OR *\\:\\\\Windows\\\\SysWOW64\\\\* OR *\\:\\\\Windows\\\\Temp\\\\* OR *\\:\\\\Windows\\\\WinSxS\\\\*)) OR (NOT _exists_:process.parent.executable) OR process.parent.executable:\"\")) AND (NOT ((process.parent.executable:\"*\\:\\\\ManageEngine\\\\ADManager\\ Plus\\\\pgsql\\\\bin\\\\postgres.exe\" AND process.executable:*\\\\cmd.exe) OR (process.command_line:\"*\\:\\\\WINDOWS\\\\system32\\\\cmd.exe\\ \\/c\\ \\\"*\" AND process.working_directory:*\\:\\\\WINDOWS\\\\Temp\\\\asgard2\\-agent\\\\*) OR (process.parent.executable:*\\:\\\\IBM\\\\SpectrumProtect\\\\webserver\\\\scripts\\\\* AND process.command_line:*\\:\\\\IBM\\\\SpectrumProtect\\\\webserver\\\\scripts\\\\*)))",
            "insightidr": "(Image=/(.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$|.*\\\\cmd\\.exe$)/i OR OriginalFileName IIN [\"PowerShell.EXE\", \"pwsh.dll\", \"Cmd.Exe\"]) AND (User ICONTAINS-ANY [\"AUTHORI\", \"AUTORI\"]) AND LogonId = NOCASE(\"0x3e7\") AND NOT (ParentImage ICONTAINS-ANY [\":\\Program Files (x86)\\\", \":\\Program Files\\\", \":\\ProgramData\\\", \":\\Windows\\System32\\\", \":\\Windows\\SysWOW64\\\", \":\\Windows\\Temp\\\", \":\\Windows\\WinSxS\\\"] OR ParentImage = null OR ParentImage = NOCASE(\"\")) AND NOT (ParentImage=/.*:\\\\ManageEngine\\\\ADManager\\ Plus\\\\pgsql\\\\bin\\\\postgres\\.exe$/i AND Image=/.*\\\\cmd\\.exe$/i OR CommandLine ICONTAINS ':\\WINDOWS\\system32\\cmd.exe /c \"' AND CurrentDirectory ICONTAINS \":\\WINDOWS\\Temp\\asgard2-agent\\\" OR ParentImage ICONTAINS \":\\IBM\\SpectrumProtect\\webserver\\scripts\\\" AND CommandLine ICONTAINS \":\\IBM\\SpectrumProtect\\webserver\\scripts\\\")"
        },
        {
            "name": "Bad Opsec Defaults Sacrificial Processes With Improper Arguments",
            "splunk": "(Image=\"*\\\\WerFault.exe\" CommandLine=\"*WerFault.exe\") OR (Image=\"*\\\\rundll32.exe\" CommandLine=\"*rundll32.exe\") OR (Image=\"*\\\\regsvcs.exe\" CommandLine=\"*regsvcs.exe\") OR (Image=\"*\\\\regasm.exe\" CommandLine=\"*regasm.exe\") OR (Image=\"*\\\\regsvr32.exe\" CommandLine=\"*regsvr32.exe\") NOT (ParentImage=\"*:\\\\Users\\\\*\" ParentImage=\"*\\\\AppData\\\\Local\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\{*\") NOT (ParentImage=\"*:\\\\Users\\\\*\" ParentImage=\"*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\*\" ParentImage=\"*\\\\Installer\\\\setup.exe\" ParentCommandLine=\"*--uninstall --channel=stable*\" Image=\"*\\\\rundll32.exe\" CommandLine=\"*rundll32.exe\")",
            "elastic": "((process.executable:*\\\\WerFault.exe AND process.command_line:*WerFault.exe) OR (process.executable:*\\\\rundll32.exe AND process.command_line:*rundll32.exe) OR (process.executable:*\\\\regsvcs.exe AND process.command_line:*regsvcs.exe) OR (process.executable:*\\\\regasm.exe AND process.command_line:*regasm.exe) OR (process.executable:*\\\\regsvr32.exe AND process.command_line:*regsvr32.exe)) AND (NOT (process.parent.executable:*\\:\\\\Users\\\\* AND process.parent.executable:*\\\\AppData\\\\Local\\\\Microsoft\\\\EdgeUpdate\\\\Install\\\\\\{*)) AND (NOT ((process.parent.executable:*\\:\\\\Users\\\\* AND process.parent.executable:*\\\\AppData\\\\Local\\\\Google\\\\Chrome\\\\Application\\\\*) AND process.parent.executable:*\\\\Installer\\\\setup.exe AND process.parent.command_line:\"*\\-\\-uninstall\\ \\-\\-channel\\=stable*\" AND process.executable:*\\\\rundll32.exe AND process.command_line:*rundll32.exe))",
            "insightidr": "(Image=/.*\\\\WerFault\\.exe$/i AND CommandLine=/.*WerFault\\.exe$/i OR Image=/.*\\\\rundll32\\.exe$/i AND CommandLine=/.*rundll32\\.exe$/i OR Image=/.*\\\\regsvcs\\.exe$/i AND CommandLine=/.*regsvcs\\.exe$/i OR Image=/.*\\\\regasm\\.exe$/i AND CommandLine=/.*regasm\\.exe$/i OR Image=/.*\\\\regsvr32\\.exe$/i AND CommandLine=/.*regsvr32\\.exe$/i) AND NOT (ParentImage ICONTAINS-ALL [\":\\Users\\\", \"\\AppData\\Local\\Microsoft\\EdgeUpdate\\Install\\{\"]) AND NOT (ParentImage ICONTAINS-ALL [\":\\Users\\\", \"\\AppData\\Local\\Google\\Chrome\\Application\\\"] AND ParentImage=/.*\\\\Installer\\\\setup\\.exe$/i AND ParentCommandLine ICONTAINS \"--uninstall --channel=stable\" AND Image=/.*\\\\rundll32\\.exe$/i AND CommandLine=/.*rundll32\\.exe$/i)"
        },
        {
            "name": "Abused Debug Privilege by Arbitrary Parent Processes",
            "splunk": "ParentImage IN (\"*\\\\winlogon.exe\", \"*\\\\services.exe\", \"*\\\\lsass.exe\", \"*\\\\csrss.exe\", \"*\\\\smss.exe\", \"*\\\\wininit.exe\", \"*\\\\spoolsv.exe\", \"*\\\\searchindexer.exe\") User IN (\"*AUTHORI*\", \"*AUTORI*\") Image IN (\"*\\\\powershell.exe\", \"*\\\\pwsh.exe\", \"*\\\\cmd.exe\") OR OriginalFileName IN (\"PowerShell.EXE\", \"pwsh.dll\", \"Cmd.Exe\") NOT (CommandLine=\"* route *\" CommandLine=\"* ADD *\") | table ParentImage,Image,User,CommandLine",
            "elastic": "(((process.parent.executable:(*\\\\winlogon.exe OR *\\\\services.exe OR *\\\\lsass.exe OR *\\\\csrss.exe OR *\\\\smss.exe OR *\\\\wininit.exe OR *\\\\spoolsv.exe OR *\\\\searchindexer.exe)) AND (winlog.event_data.User:(*AUTHORI* OR *AUTORI*))) AND ((process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe OR *\\\\cmd.exe)) OR (process.pe.original_file_name:(PowerShell.EXE OR pwsh.dll OR Cmd.Exe)))) AND (NOT (process.command_line:\"*\\ route\\ *\" AND process.command_line:\"*\\ ADD\\ *\"))",
            "insightidr": "(ParentImage=/(.*\\\\winlogon\\.exe$|.*\\\\services\\.exe$|.*\\\\lsass\\.exe$|.*\\\\csrss\\.exe$|.*\\\\smss\\.exe$|.*\\\\wininit\\.exe$|.*\\\\spoolsv\\.exe$|.*\\\\searchindexer\\.exe$)/i) AND (User ICONTAINS-ANY [\"AUTHORI\", \"AUTORI\"]) AND (Image=/(.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$|.*\\\\cmd\\.exe$)/i OR OriginalFileName IIN [\"PowerShell.EXE\", \"pwsh.dll\", \"Cmd.Exe\"]) AND NOT (CommandLine ICONTAINS-ALL [\" route \", \" ADD \"])"
        },
        {
            "name": "Suspicious Scheduled Task Creation via Masqueraded XML File",
            "splunk": "Image=\"*\\\\schtasks.exe\" OR OriginalFileName=\"schtasks.exe\" CommandLine IN (\"*/create*\", \"*-create*\") CommandLine IN (\"*/xml*\", \"*-xml*\") NOT (CommandLine=\"*.xml*\" OR IntegrityLevel=\"System\" OR (ParentImage=\"*\\\\rundll32.exe\" ParentCommandLine=\"*:\\\\WINDOWS\\\\Installer\\\\MSI*\" ParentCommandLine=\"*.tmp,zzzzInvokeManagedCustomActionOutOfProc*\")) NOT (ParentImage IN (\"*:\\\\ProgramData\\\\OEM\\\\UpgradeTool\\\\CareCenter_*\\\\BUnzip\\\\Setup_msi.exe\", \"*:\\\\Program Files\\\\Axis Communications\\\\AXIS Camera Station\\\\SetupActions.exe\", \"*:\\\\Program Files\\\\Axis Communications\\\\AXIS Device Manager\\\\AdmSetupActions.exe\", \"*:\\\\Program Files (x86)\\\\Zemana\\\\AntiMalware\\\\AntiMalware.exe\", \"*:\\\\Program Files\\\\Dell\\\\SupportAssist\\\\pcdrcui.exe\"))",
            "elastic": "((process.executable:*\\\\schtasks.exe OR process.pe.original_file_name:schtasks.exe) AND (process.command_line:(*\\/create* OR *\\-create*)) AND (process.command_line:(*\\/xml* OR *\\-xml*))) AND (NOT (process.command_line:*.xml* OR winlog.event_data.IntegrityLevel:System OR (process.parent.executable:*\\\\rundll32.exe AND (process.parent.command_line:*\\:\\\\WINDOWS\\\\Installer\\\\MSI* AND process.parent.command_line:*.tmp,zzzzInvokeManagedCustomActionOutOfProc*)))) AND (NOT (process.parent.executable:(*\\:\\\\ProgramData\\\\OEM\\\\UpgradeTool\\\\CareCenter_*\\\\BUnzip\\\\Setup_msi.exe OR \"*\\:\\\\Program\\ Files\\\\Axis\\ Communications\\\\AXIS\\ Camera\\ Station\\\\SetupActions.exe\" OR \"*\\:\\\\Program\\ Files\\\\Axis\\ Communications\\\\AXIS\\ Device\\ Manager\\\\AdmSetupActions.exe\" OR \"*\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Zemana\\\\AntiMalware\\\\AntiMalware.exe\" OR \"*\\:\\\\Program\\ Files\\\\Dell\\\\SupportAssist\\\\pcdrcui.exe\")))",
            "insightidr": "(Image=/.*\\\\schtasks\\.exe$/i OR OriginalFileName = NOCASE(\"schtasks.exe\")) AND (CommandLine ICONTAINS-ANY [\"/create\", \"-create\"]) AND (CommandLine ICONTAINS-ANY [\"/xml\", \"-xml\"]) AND NOT (CommandLine ICONTAINS \".xml\" OR IntegrityLevel = NOCASE(\"System\") OR ParentImage=/.*\\\\rundll32\\.exe$/i AND ParentCommandLine ICONTAINS-ALL [\":\\WINDOWS\\Installer\\MSI\", \".tmp,zzzzInvokeManagedCustomActionOutOfProc\"]) AND NOT (ParentImage=/(.*:\\\\ProgramData\\\\OEM\\\\UpgradeTool\\\\CareCenter_\\*\\\\BUnzip\\\\Setup_msi\\.exe$|.*:\\\\Program\\ Files\\\\Axis\\ Communications\\\\AXIS\\ Camera\\ Station\\\\SetupActions\\.exe$|.*:\\\\Program\\ Files\\\\Axis\\ Communications\\\\AXIS\\ Device\\ Manager\\\\AdmSetupActions\\.exe$|.*:\\\\Program\\ Files\\ \\(x86\\)\\\\Zemana\\\\AntiMalware\\\\AntiMalware\\.exe$|.*:\\\\Program\\ Files\\\\Dell\\\\SupportAssist\\\\pcdrcui\\.exe$)/i)"
        },
        {
            "name": "Suspicious Schtasks Schedule Type With High Privileges",
            "splunk": "Image=\"*\\\\schtasks.exe\" OR OriginalFileName=\"schtasks.exe\" CommandLine IN (\"* ONLOGON *\", \"* ONSTART *\", \"* ONCE *\", \"* ONIDLE *\") CommandLine IN (\"*NT AUT*\", \"* SYSTEM*\", \"*HIGHEST*\")",
            "elastic": "(process.executable:*\\\\schtasks.exe OR process.pe.original_file_name:schtasks.exe) AND (process.command_line:(\"*\\ ONLOGON\\ *\" OR \"*\\ ONSTART\\ *\" OR \"*\\ ONCE\\ *\" OR \"*\\ ONIDLE\\ *\")) AND (process.command_line:(\"*NT\\ AUT*\" OR \"*\\ SYSTEM*\" OR *HIGHEST*))",
            "insightidr": "(Image=/.*\\\\schtasks\\.exe$/i OR OriginalFileName = NOCASE(\"schtasks.exe\")) AND (CommandLine ICONTAINS-ANY [\" ONLOGON \", \" ONSTART \", \" ONCE \", \" ONIDLE \"]) AND (CommandLine ICONTAINS-ANY [\"NT AUT\", \" SYSTEM\", \"HIGHEST\"])"
        },
        {
            "name": "Suspicious Schtasks Schedule Types",
            "splunk": "Image=\"*\\\\schtasks.exe\" OR OriginalFileName=\"schtasks.exe\" CommandLine IN (\"* ONLOGON *\", \"* ONSTART *\", \"* ONCE *\", \"* ONIDLE *\") NOT (CommandLine IN (\"*NT AUT*\", \"* SYSTEM*\", \"*HIGHEST*\"))",
            "elastic": "((process.executable:*\\\\schtasks.exe OR process.pe.original_file_name:schtasks.exe) AND (process.command_line:(\"*\\ ONLOGON\\ *\" OR \"*\\ ONSTART\\ *\" OR \"*\\ ONCE\\ *\" OR \"*\\ ONIDLE\\ *\"))) AND (NOT (process.command_line:(\"*NT\\ AUT*\" OR \"*\\ SYSTEM*\" OR *HIGHEST*)))",
            "insightidr": "(Image=/.*\\\\schtasks\\.exe$/i OR OriginalFileName = NOCASE(\"schtasks.exe\")) AND (CommandLine ICONTAINS-ANY [\" ONLOGON \", \" ONSTART \", \" ONCE \", \" ONIDLE \"]) AND NOT (CommandLine ICONTAINS-ANY [\"NT AUT\", \" SYSTEM\", \"HIGHEST\"])"
        },
        {
            "name": "Suspicious Add Scheduled Task Parent",
            "splunk": "Image=\"*\\\\schtasks.exe\" CommandLine=\"*/Create *\" ParentImage IN (\"*\\\\AppData\\\\Local\\\\*\", \"*\\\\AppData\\\\Roaming\\\\*\", \"*\\\\Temporary Internet*\", \"*\\\\Users\\\\Public\\\\*\") NOT (CommandLine IN (\"*update_task.xml*\", \"*unattended.ini*\"))",
            "elastic": "(process.executable:*\\\\schtasks.exe AND process.command_line:\"*\\/Create\\ *\" AND (process.parent.executable:(*\\\\AppData\\\\Local\\\\* OR *\\\\AppData\\\\Roaming\\\\* OR \"*\\\\Temporary\\ Internet*\" OR *\\\\Users\\\\Public\\\\*))) AND (NOT (process.command_line:(*update_task.xml* OR *unattended.ini*)))",
            "insightidr": "Image=/.*\\\\schtasks\\.exe$/i AND CommandLine ICONTAINS \"/Create \" AND (ParentImage ICONTAINS-ANY [\"\\AppData\\Local\\\", \"\\AppData\\Roaming\\\", \"\\Temporary Internet\", \"\\Users\\Public\\\"]) AND NOT (CommandLine ICONTAINS-ANY [\"update_task.xml\", \"unattended.ini\"])"
        },
        {
            "name": "Uncommon One Time Only Scheduled Task At 00:00",
            "splunk": "Image=\"*\\\\schtasks.exe*\" OR OriginalFileName=\"schtasks.exe\" CommandLine IN (\"*wscript*\", \"*vbscript*\", \"*cscript*\", \"*wmic *\", \"*wmic.exe*\", \"*regsvr32.exe*\", \"*powershell*\", \"*\\\\AppData\\\\*\") CommandLine=\"*once*\" CommandLine=\"*00:00*\"",
            "elastic": "(process.executable:*\\\\schtasks.exe* OR process.pe.original_file_name:schtasks.exe) AND (process.command_line:(*wscript* OR *vbscript* OR *cscript* OR \"*wmic\\ *\" OR *wmic.exe* OR *regsvr32.exe* OR *powershell* OR *\\\\AppData\\\\*)) AND (process.command_line:*once* AND process.command_line:*00\\:00*)",
            "insightidr": "(Image ICONTAINS \"\\schtasks.exe\" OR OriginalFileName = NOCASE(\"schtasks.exe\")) AND (CommandLine ICONTAINS-ANY [\"wscript\", \"vbscript\", \"cscript\", \"wmic \", \"wmic.exe\", \"regsvr32.exe\", \"powershell\", \"\\AppData\\\"]) AND CommandLine ICONTAINS-ALL [\"once\", \"00:00\"]"
        },
        {
            "name": "Suspicious Schtasks From Env Var Folder",
            "splunk": "(Image=\"*\\\\schtasks.exe\" CommandLine=\"* /create *\" CommandLine IN (\"*:\\\\Perflogs*\", \"*:\\\\Windows\\\\Temp*\", \"*\\\\AppData\\\\Local\\\\*\", \"*\\\\AppData\\\\Roaming\\\\*\", \"*\\\\Users\\\\Public*\", \"*%AppData%*\", \"*%Public%*\")) OR (ParentCommandLine=\"*\\\\svchost.exe -k netsvcs -p -s Schedule\" CommandLine IN (\"*:\\\\Perflogs*\", \"*:\\\\Windows\\\\Temp*\", \"*\\\\Users\\\\Public*\", \"*%Public%*\")) NOT (CommandLine IN (\"*update_task.xml*\", \"*/Create /TN TVInstallRestore /TR*\") OR ParentCommandLine=\"*unattended.ini*\" OR (CommandLine=\"*/Create /Xml \\\"C:\\\\Users\\\\*\" CommandLine=\"*\\\\AppData\\\\Local\\\\Temp\\\\.CR.*\" CommandLine=\"*Avira_Security_Installation.xml*\") OR (CommandLine=\"*/Create /F /TN*\" CommandLine=\"*/Xml *\" CommandLine=\"*\\\\AppData\\\\Local\\\\Temp\\\\is-*\" CommandLine=\"*Avira_*\" CommandLine IN (\"*.tmp\\\\UpdateFallbackTask.xml*\", \"*.tmp\\\\WatchdogServiceControlManagerTimeout.xml*\", \"*.tmp\\\\SystrayAutostart.xml*\", \"*.tmp\\\\MaintenanceTask.xml*\")) OR (CommandLine=\"*\\\\AppData\\\\Local\\\\Temp\\\\*\" CommandLine=\"*/Create /TN \\\"klcp_update\\\" /XML *\" CommandLine=\"*\\\\klcp_update_task.xml*\"))",
            "elastic": "(((process.executable:*\\\\schtasks.exe AND process.command_line:\"*\\ \\/create\\ *\") AND (process.command_line:(*\\:\\\\Perflogs* OR *\\:\\\\Windows\\\\Temp* OR *\\\\AppData\\\\Local\\\\* OR *\\\\AppData\\\\Roaming\\\\* OR *\\\\Users\\\\Public* OR *%AppData%* OR *%Public%*))) OR (process.parent.command_line:\"*\\\\svchost.exe\\ \\-k\\ netsvcs\\ \\-p\\ \\-s\\ Schedule\" AND (process.command_line:(*\\:\\\\Perflogs* OR *\\:\\\\Windows\\\\Temp* OR *\\\\Users\\\\Public* OR *%Public%*)))) AND (NOT (((process.command_line:(*update_task.xml* OR \"*\\/Create\\ \\/TN\\ TVInstallRestore\\ \\/TR*\")) OR process.parent.command_line:*unattended.ini*) OR (process.command_line:\"*\\/Create\\ \\/Xml\\ \\\"C\\:\\\\Users\\\\*\" AND process.command_line:*\\\\AppData\\\\Local\\\\Temp\\\\.CR.* AND process.command_line:*Avira_Security_Installation.xml*) OR ((process.command_line:\"*\\/Create\\ \\/F\\ \\/TN*\" AND process.command_line:\"*\\/Xml\\ *\" AND process.command_line:*\\\\AppData\\\\Local\\\\Temp\\\\is\\-* AND process.command_line:*Avira_*) AND (process.command_line:(*.tmp\\\\UpdateFallbackTask.xml* OR *.tmp\\\\WatchdogServiceControlManagerTimeout.xml* OR *.tmp\\\\SystrayAutostart.xml* OR *.tmp\\\\MaintenanceTask.xml*))) OR (process.command_line:*\\\\AppData\\\\Local\\\\Temp\\\\* AND process.command_line:\"*\\/Create\\ \\/TN\\ \\\"klcp_update\\\"\\ \\/XML\\ *\" AND process.command_line:*\\\\klcp_update_task.xml*)))",
            "insightidr": "(Image=/.*\\\\schtasks\\.exe$/i AND CommandLine ICONTAINS \" /create \" AND (CommandLine ICONTAINS-ANY [\":\\Perflogs\", \":\\Windows\\Temp\", \"\\AppData\\Local\\\", \"\\AppData\\Roaming\\\", \"\\Users\\Public\", \"%AppData%\", \"%Public%\"]) OR ParentCommandLine=/.*\\\\svchost\\.exe\\ \\-k\\ netsvcs\\ \\-p\\ \\-s\\ Schedule$/i AND (CommandLine ICONTAINS-ANY [\":\\Perflogs\", \":\\Windows\\Temp\", \"\\Users\\Public\", \"%Public%\"])) AND NOT (CommandLine ICONTAINS-ANY [\"update_task.xml\", \"/Create /TN TVInstallRestore /TR\"] OR ParentCommandLine ICONTAINS \"unattended.ini\" OR CommandLine ICONTAINS-ALL ['/Create /Xml \"C:\\Users\\', \"\\AppData\\Local\\Temp\\.CR.\", \"Avira_Security_Installation.xml\"] OR CommandLine ICONTAINS-ALL [\"/Create /F /TN\", \"/Xml \", \"\\AppData\\Local\\Temp\\is-\", \"Avira_\"] AND (CommandLine ICONTAINS-ANY [\".tmp\\UpdateFallbackTask.xml\", \".tmp\\WatchdogServiceControlManagerTimeout.xml\", \".tmp\\SystrayAutostart.xml\", \".tmp\\MaintenanceTask.xml\"]) OR CommandLine ICONTAINS-ALL [\"\\AppData\\Local\\Temp\\\", '/Create /TN \"klcp_update\" /XML ', \"\\klcp_update_task.xml\"])"
        },
        {
            "name": "Delete All Scheduled Tasks",
            "splunk": "Image=\"*\\\\schtasks.exe\" CommandLine=\"* /delete *\" CommandLine=\"*/tn \\**\" CommandLine=\"* /f*\"",
            "elastic": "process.executable:*\\\\schtasks.exe AND (process.command_line:\"*\\ \\/delete\\ *\" AND process.command_line:\"*\\/tn\\ \\**\" AND process.command_line:\"*\\ \\/f*\")",
            "insightidr": "Image=/.*\\\\schtasks\\.exe$/i AND CommandLine ICONTAINS-ALL [\" /delete \", \"/tn \", \" /f\"]"
        },
        {
            "name": "Suspicious Scheduled Task Creation Involving Temp Folder",
            "splunk": "Image=\"*\\\\schtasks.exe\" CommandLine=\"* /create *\" CommandLine=\"* /sc once *\" CommandLine=\"*\\\\Temp\\\\*\" | table CommandLine,ParentCommandLine",
            "elastic": "process.executable:*\\\\schtasks.exe AND (process.command_line:\"*\\ \\/create\\ *\" AND process.command_line:\"*\\ \\/sc\\ once\\ *\" AND process.command_line:*\\\\Temp\\\\*)",
            "insightidr": "Image=/.*\\\\schtasks\\.exe$/i AND CommandLine ICONTAINS-ALL [\" /create \", \" /sc once \", \"\\Temp\\\"]"
        },
        {
            "name": "Scheduled Task Creation Via Schtasks.EXE",
            "splunk": "Image=\"*\\\\schtasks.exe\" CommandLine=\"* /create *\" NOT (User IN (\"*AUTHORI*\", \"*AUTORI*\"))",
            "elastic": "(process.executable:*\\\\schtasks.exe AND process.command_line:\"*\\ \\/create\\ *\") AND (NOT (winlog.event_data.User:(*AUTHORI* OR *AUTORI*)))",
            "insightidr": "Image=/.*\\\\schtasks\\.exe$/i AND CommandLine ICONTAINS \" /create \" AND NOT (User ICONTAINS-ANY [\"AUTHORI\", \"AUTORI\"])"
        },
        {
            "name": "Service Security Descriptor Tampering Via Sc.EXE",
            "splunk": "Image=\"*\\\\sc.exe\" OR OriginalFileName=\"sc.exe\" CommandLine=\"*sdset*\"",
            "elastic": "(process.executable:*\\\\sc.exe OR process.pe.original_file_name:sc.exe) AND process.command_line:*sdset*",
            "insightidr": "(Image=/.*\\\\sc\\.exe$/i OR OriginalFileName = NOCASE(\"sc.exe\")) AND CommandLine ICONTAINS \"sdset\""
        },
        {
            "name": "Deny Service Access Using Security Descriptor Tampering Via Sc.EXE",
            "splunk": "Image=\"*\\\\sc.exe\" OR OriginalFileName=\"sc.exe\" CommandLine=\"*sdset*\" CommandLine=\"*D;*\" CommandLine IN (\"*;IU*\", \"*;SU*\", \"*;BA*\", \"*;SY*\", \"*;WD*\")",
            "elastic": "(process.executable:*\\\\sc.exe OR process.pe.original_file_name:sc.exe) AND (process.command_line:*sdset* AND process.command_line:*D;*) AND (process.command_line:(*;IU* OR *;SU* OR *;BA* OR *;SY* OR *;WD*))",
            "insightidr": "(Image=/.*\\\\sc\\.exe$/i OR OriginalFileName = NOCASE(\"sc.exe\")) AND CommandLine ICONTAINS-ALL [\"sdset\", \"D;\"] AND (CommandLine ICONTAINS-ANY [\";IU\", \";SU\", \";BA\", \";SY\", \";WD\"])"
        },
        {
            "name": "Allow Service Access Using Security Descriptor Tampering Via Sc.EXE",
            "splunk": "Image=\"*\\\\sc.exe\" OR OriginalFileName=\"sc.exe\" CommandLine=\"*sdset*\" CommandLine=\"*A;*\" CommandLine IN (\"*;IU*\", \"*;SU*\", \"*;BA*\", \"*;SY*\", \"*;WD*\")",
            "elastic": "(process.executable:*\\\\sc.exe OR process.pe.original_file_name:sc.exe) AND (process.command_line:*sdset* AND process.command_line:*A;*) AND (process.command_line:(*;IU* OR *;SU* OR *;BA* OR *;SY* OR *;WD*))",
            "insightidr": "(Image=/.*\\\\sc\\.exe$/i OR OriginalFileName = NOCASE(\"sc.exe\")) AND CommandLine ICONTAINS-ALL [\"sdset\", \"A;\"] AND (CommandLine ICONTAINS-ANY [\";IU\", \";SU\", \";BA\", \";SY\", \";WD\"])"
        },
        {
            "name": "New Service Creation Using Sc.EXE",
            "splunk": "Image=\"*\\\\sc.exe\" CommandLine=\"*create*\" CommandLine=\"*binPath*\"",
            "elastic": "process.executable:*\\\\sc.exe AND (process.command_line:*create* AND process.command_line:*binPath*)",
            "insightidr": "Image=/.*\\\\sc\\.exe$/i AND CommandLine ICONTAINS-ALL [\"create\", \"binPath\"]"
        },
        {
            "name": "Rundll32 Execution With Uncommon DLL Extension",
            "splunk": "Image=\"*\\\\rundll32.exe\" OR OriginalFileName=\"RUNDLL32.EXE\" NOT (CommandLine!=* OR CommandLine=\"\" OR CommandLine IN (\"*.cpl *\", \"*.cpl,*\", \"*.dll *\", \"*.dll,*\", \"*.inf *\", \"*.inf,*\") OR CommandLine IN (\"*.cpl\", \"*.cpl\\\"\", \"*.dll\", \"*.dll\\\"\", \"*.inf\", \"*.inf\\\"\", \"*.cpl'\", \"*.dll'\", \"*.inf'\") OR CommandLine=\"* -localserver *\" OR (ParentImage=\"*\\\\msiexec.exe\" CommandLine=\"*:\\\\Windows\\\\Installer\\\\*\" CommandLine=\"*.tmp*\" CommandLine=\"*zzzzInvokeManagedCustomActionOutOfProc*\"))",
            "elastic": "(process.executable:*\\\\rundll32.exe OR process.pe.original_file_name:RUNDLL32.EXE) AND (NOT ((NOT _exists_:process.command_line) OR process.command_line:\"\" OR ((process.command_line:(\"*.cpl\\ *\" OR *.cpl,* OR \"*.dll\\ *\" OR *.dll,* OR \"*.inf\\ *\" OR *.inf,*)) OR (process.command_line:(*.cpl OR *.cpl\\\" OR *.dll OR *.dll\\\" OR *.inf OR *.inf\\\" OR *.cpl' OR *.dll' OR *.inf'))) OR process.command_line:\"*\\ \\-localserver\\ *\" OR (process.parent.executable:*\\\\msiexec.exe AND (process.command_line:*\\:\\\\Windows\\\\Installer\\\\* AND process.command_line:*.tmp* AND process.command_line:*zzzzInvokeManagedCustomActionOutOfProc*))))",
            "insightidr": "(Image=/.*\\\\rundll32\\.exe$/i OR OriginalFileName = NOCASE(\"RUNDLL32.EXE\")) AND NOT (CommandLine = null OR CommandLine = NOCASE(\"\") OR CommandLine ICONTAINS-ANY [\".cpl \", \".cpl,\", \".dll \", \".dll,\", \".inf \", \".inf,\"] OR CommandLine=/(.*\\.cpl$|.*\\.cpl\"$|.*\\.dll$|.*\\.dll\"$|.*\\.inf$|.*\\.inf\"$|.*\\.cpl'$|.*\\.dll'$|.*\\.inf'$)/i OR CommandLine ICONTAINS \" -localserver \" OR ParentImage=/.*\\\\msiexec\\.exe$/i AND CommandLine ICONTAINS-ALL [\":\\Windows\\Installer\\\", \".tmp\", \"zzzzInvokeManagedCustomActionOutOfProc\"])"
        },
        {
            "name": "Suspicious Call by Ordinal",
            "splunk": "Image=\"*\\\\rundll32.exe\" OR OriginalFileName=\"RUNDLL32.EXE\" CommandLine IN (\"*,#*\", \"*, #*\", \"*.dll #*\", \"*.ocx #*\") NOT ((CommandLine=\"*EDGEHTML.dll*\" CommandLine=\"*#141*\") OR (ParentImage IN (\"*\\\\Msbuild\\\\Current\\\\Bin\\\\*\", \"*\\\\VC\\\\Tools\\\\MSVC\\\\*\", \"*\\\\Tracker.exe*\") CommandLine IN (\"*\\\\FileTracker32.dll,#1*\", \"*\\\\FileTracker32.dll\\\",#1*\", \"*\\\\FileTracker64.dll,#1*\", \"*\\\\FileTracker64.dll\\\",#1*\")))",
            "elastic": "((process.executable:*\\\\rundll32.exe OR process.pe.original_file_name:RUNDLL32.EXE) AND (process.command_line:(*,#* OR \"*,\\ #*\" OR \"*.dll\\ #*\" OR \"*.ocx\\ #*\"))) AND (NOT ((process.command_line:*EDGEHTML.dll* AND process.command_line:*#141*) OR ((process.parent.executable:(*\\\\Msbuild\\\\Current\\\\Bin\\\\* OR *\\\\VC\\\\Tools\\\\MSVC\\\\* OR *\\\\Tracker.exe*)) AND (process.command_line:(*\\\\FileTracker32.dll,#1* OR *\\\\FileTracker32.dll\\\",#1* OR *\\\\FileTracker64.dll,#1* OR *\\\\FileTracker64.dll\\\",#1*)))))",
            "insightidr": "(Image=/.*\\\\rundll32\\.exe$/i OR OriginalFileName = NOCASE(\"RUNDLL32.EXE\")) AND (CommandLine ICONTAINS-ANY [\",#\", \", #\", \".dll #\", \".ocx #\"]) AND NOT (CommandLine ICONTAINS-ALL [\"EDGEHTML.dll\", \"#141\"] OR (ParentImage ICONTAINS-ANY [\"\\Msbuild\\Current\\Bin\\\", \"\\VC\\Tools\\MSVC\\\", \"\\Tracker.exe\"]) AND (CommandLine ICONTAINS-ANY [\"\\FileTracker32.dll,#1\", '\\FileTracker32.dll\",#1', \"\\FileTracker64.dll,#1\", '\\FileTracker64.dll\",#1']))"
        },
        {
            "name": "Renamed Plink Execution",
            "splunk": "OriginalFileName=\"Plink\" OR (CommandLine=\"* -l forward*\" CommandLine=\"* -P *\" CommandLine=\"* -R *\") NOT Image=\"*\\\\plink.exe\"",
            "elastic": "(process.pe.original_file_name:Plink OR (process.command_line:\"*\\ \\-l\\ forward*\" AND process.command_line:\"*\\ \\-P\\ *\" AND process.command_line:\"*\\ \\-R\\ *\")) AND (NOT process.executable:*\\\\plink.exe)",
            "insightidr": "(OriginalFileName = NOCASE(\"Plink\") OR CommandLine ICONTAINS-ALL [\" -l forward\", \" -P \", \" -R \"]) AND NOT Image=/.*\\\\plink\\.exe$/i"
        },
        {
            "name": "Renamed AutoIt Execution",
            "splunk": "CommandLine IN (\"* /AutoIt3ExecuteScript*\", \"* /ErrorStdOut*\") OR Imphash IN (\"fdc554b3a8683918d731685855683ddf\", \"cd30a61b60b3d60cecdb034c8c83c290\", \"f8a00c72f2d667d2edbb234d0c0ae000\") OR Hashes IN (\"*IMPHASH=FDC554B3A8683918D731685855683DDF*\", \"*IMPHASH=CD30A61B60B3D60CECDB034C8C83C290*\", \"*IMPHASH=F8A00C72F2D667D2EDBB234D0C0AE000*\") OR OriginalFileName IN (\"AutoIt3.exe\", \"AutoIt2.exe\", \"AutoIt.exe\") NOT (Image IN (\"*\\\\AutoIt.exe\", \"*\\\\AutoIt2.exe\", \"*\\\\AutoIt3_x64.exe\", \"*\\\\AutoIt3.exe\"))",
            "elastic": "((process.command_line:(\"*\\ \\/AutoIt3ExecuteScript*\" OR \"*\\ \\/ErrorStdOut*\")) OR ((winlog.event_data.Imphash:(fdc554b3a8683918d731685855683ddf OR cd30a61b60b3d60cecdb034c8c83c290 OR f8a00c72f2d667d2edbb234d0c0ae000)) OR (winlog.event_data.Hashes:(*IMPHASH\\=FDC554B3A8683918D731685855683DDF* OR *IMPHASH\\=CD30A61B60B3D60CECDB034C8C83C290* OR *IMPHASH\\=F8A00C72F2D667D2EDBB234D0C0AE000*))) OR (process.pe.original_file_name:(AutoIt3.exe OR AutoIt2.exe OR AutoIt.exe))) AND (NOT (process.executable:(*\\\\AutoIt.exe OR *\\\\AutoIt2.exe OR *\\\\AutoIt3_x64.exe OR *\\\\AutoIt3.exe)))",
            "insightidr": "(CommandLine ICONTAINS-ANY [\" /AutoIt3ExecuteScript\", \" /ErrorStdOut\"] OR Imphash IIN [\"fdc554b3a8683918d731685855683ddf\", \"cd30a61b60b3d60cecdb034c8c83c290\", \"f8a00c72f2d667d2edbb234d0c0ae000\"] OR Hashes ICONTAINS-ANY [\"IMPHASH=FDC554B3A8683918D731685855683DDF\", \"IMPHASH=CD30A61B60B3D60CECDB034C8C83C290\", \"IMPHASH=F8A00C72F2D667D2EDBB234D0C0AE000\"] OR OriginalFileName IIN [\"AutoIt3.exe\", \"AutoIt2.exe\", \"AutoIt.exe\"]) AND NOT (Image=/(.*\\\\AutoIt\\.exe$|.*\\\\AutoIt2\\.exe$|.*\\\\AutoIt3_x64\\.exe$|.*\\\\AutoIt3\\.exe$)/i)"
        },
        {
            "name": "Suspicious Windows Defender Registry Key Tampering Via Reg.EXE",
            "splunk": "Image=\"*\\\\reg.exe\" OR OriginalFileName=\"reg.exe\" CommandLine IN (\"*SOFTWARE\\\\Microsoft\\\\Windows Defender\\\\*\", \"*SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender Security Center*\", \"*SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows Defender\\\\*\") (CommandLine=\"* add *\" CommandLine=\"*d 0*\" CommandLine IN (\"*DisallowExploitProtectionOverride*\", \"*EnableControlledFolderAccess*\", \"*MpEnablePus*\", \"*PUAProtection*\", \"*SpynetReporting*\", \"*SubmitSamplesConsent*\", \"*TamperProtection*\")) OR (CommandLine=\"* add *\" CommandLine=\"*d 1*\" CommandLine IN (\"*DisableAntiSpyware*\", \"*DisableAntiSpywareRealtimeProtection*\", \"*DisableAntiVirus*\", \"*DisableArchiveScanning*\", \"*DisableBehaviorMonitoring*\", \"*DisableBlockAtFirstSeen*\", \"*DisableConfig*\", \"*DisableEnhancedNotifications*\", \"*DisableIntrusionPreventionSystem*\", \"*DisableIOAVProtection*\", \"*DisableOnAccessProtection*\", \"*DisablePrivacyMode*\", \"*DisableRealtimeMonitoring*\", \"*DisableRoutinelyTakingAction*\", \"*DisableScanOnRealtimeEnable*\", \"*DisableScriptScanning*\", \"*Notification_Suppress*\", \"*SignatureDisableUpdateOnStartupWithoutEngine*\"))",
            "elastic": "((process.executable:*\\\\reg.exe OR process.pe.original_file_name:reg.exe) AND (process.command_line:(\"*SOFTWARE\\\\Microsoft\\\\Windows\\ Defender\\\\*\" OR \"*SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\ Defender\\ Security\\ Center*\" OR \"*SOFTWARE\\\\Policies\\\\Microsoft\\\\Windows\\ Defender\\\\*\"))) AND (((process.command_line:\"*\\ add\\ *\" AND process.command_line:\"*d\\ 0*\") AND (process.command_line:(*DisallowExploitProtectionOverride* OR *EnableControlledFolderAccess* OR *MpEnablePus* OR *PUAProtection* OR *SpynetReporting* OR *SubmitSamplesConsent* OR *TamperProtection*))) OR ((process.command_line:\"*\\ add\\ *\" AND process.command_line:\"*d\\ 1*\") AND (process.command_line:(*DisableAntiSpyware* OR *DisableAntiSpywareRealtimeProtection* OR *DisableAntiVirus* OR *DisableArchiveScanning* OR *DisableBehaviorMonitoring* OR *DisableBlockAtFirstSeen* OR *DisableConfig* OR *DisableEnhancedNotifications* OR *DisableIntrusionPreventionSystem* OR *DisableIOAVProtection* OR *DisableOnAccessProtection* OR *DisablePrivacyMode* OR *DisableRealtimeMonitoring* OR *DisableRoutinelyTakingAction* OR *DisableScanOnRealtimeEnable* OR *DisableScriptScanning* OR *Notification_Suppress* OR *SignatureDisableUpdateOnStartupWithoutEngine*))))",
            "insightidr": "(Image=/.*\\\\reg\\.exe$/i OR OriginalFileName = NOCASE(\"reg.exe\")) AND (CommandLine ICONTAINS-ANY [\"SOFTWARE\\Microsoft\\Windows Defender\\\", \"SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\", \"SOFTWARE\\Policies\\Microsoft\\Windows Defender\\\"]) AND (CommandLine ICONTAINS-ALL [\" add \", \"d 0\"] AND (CommandLine ICONTAINS-ANY [\"DisallowExploitProtectionOverride\", \"EnableControlledFolderAccess\", \"MpEnablePus\", \"PUAProtection\", \"SpynetReporting\", \"SubmitSamplesConsent\", \"TamperProtection\"]) OR CommandLine ICONTAINS-ALL [\" add \", \"d 1\"] AND (CommandLine ICONTAINS-ANY [\"DisableAntiSpyware\", \"DisableAntiSpywareRealtimeProtection\", \"DisableAntiVirus\", \"DisableArchiveScanning\", \"DisableBehaviorMonitoring\", \"DisableBlockAtFirstSeen\", \"DisableConfig\", \"DisableEnhancedNotifications\", \"DisableIntrusionPreventionSystem\", \"DisableIOAVProtection\", \"DisableOnAccessProtection\", \"DisablePrivacyMode\", \"DisableRealtimeMonitoring\", \"DisableRoutinelyTakingAction\", \"DisableScanOnRealtimeEnable\", \"DisableScriptScanning\", \"Notification_Suppress\", \"SignatureDisableUpdateOnStartupWithoutEngine\"]))"
        },
        {
            "name": "Reg Add Suspicious Paths",
            "splunk": "Image=\"*\\\\reg.exe\" OR OriginalFileName=\"reg.exe\" CommandLine IN (\"*\\\\AppDataLow\\\\Software\\\\Microsoft\\\\*\", \"*\\\\Policies\\\\Microsoft\\\\Windows\\\\OOBE*\", \"*\\\\Policies\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Winlogon*\", \"*\\\\SOFTWARE\\\\Microsoft\\\\Windows NT\\\\Currentversion\\\\Winlogon*\", \"*\\\\CurrentControlSet\\\\Control\\\\SecurityProviders\\\\WDigest*\", \"*\\\\Microsoft\\\\Windows Defender\\\\*\")",
            "elastic": "(process.executable:*\\\\reg.exe OR process.pe.original_file_name:reg.exe) AND (process.command_line:(*\\\\AppDataLow\\\\Software\\\\Microsoft\\\\* OR *\\\\Policies\\\\Microsoft\\\\Windows\\\\OOBE* OR \"*\\\\Policies\\\\Microsoft\\\\Windows\\ NT\\\\CurrentVersion\\\\Winlogon*\" OR \"*\\\\SOFTWARE\\\\Microsoft\\\\Windows\\ NT\\\\Currentversion\\\\Winlogon*\" OR *\\\\CurrentControlSet\\\\Control\\\\SecurityProviders\\\\WDigest* OR \"*\\\\Microsoft\\\\Windows\\ Defender\\\\*\"))",
            "insightidr": "(Image=/.*\\\\reg\\.exe$/i OR OriginalFileName = NOCASE(\"reg.exe\")) AND (CommandLine ICONTAINS-ANY [\"\\AppDataLow\\Software\\Microsoft\\\", \"\\Policies\\Microsoft\\Windows\\OOBE\", \"\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\", \"\\SOFTWARE\\Microsoft\\Windows NT\\Currentversion\\Winlogon\", \"\\CurrentControlSet\\Control\\SecurityProviders\\WDigest\", \"\\Microsoft\\Windows Defender\\\"])"
        },
        {
            "name": "Potential Configuration And Service Reconnaissance Via Reg.EXE",
            "splunk": "Image=\"*\\\\reg.exe\" OR OriginalFileName=\"reg.exe\" CommandLine=\"*query*\" CommandLine IN (\"*currentVersion\\\\windows*\", \"*winlogon\\\\*\", \"*currentVersion\\\\shellServiceObjectDelayLoad*\", \"*currentVersion\\\\run*\", \"*currentVersion\\\\policies\\\\explorer\\\\run*\", \"*currentcontrolset\\\\services*\")",
            "elastic": "(process.executable:*\\\\reg.exe OR process.pe.original_file_name:reg.exe) AND process.command_line:*query* AND (process.command_line:(*currentVersion\\\\windows* OR *winlogon\\\\* OR *currentVersion\\\\shellServiceObjectDelayLoad* OR *currentVersion\\\\run* OR *currentVersion\\\\policies\\\\explorer\\\\run* OR *currentcontrolset\\\\services*))",
            "insightidr": "(Image=/.*\\\\reg\\.exe$/i OR OriginalFileName = NOCASE(\"reg.exe\")) AND CommandLine ICONTAINS \"query\" AND (CommandLine ICONTAINS-ANY [\"currentVersion\\windows\", \"winlogon\\\", \"currentVersion\\shellServiceObjectDelayLoad\", \"currentVersion\\run\", \"currentVersion\\policies\\explorer\\run\", \"currentcontrolset\\services\"])"
        },
        {
            "name": "Change PowerShell Policies to an Insecure Level",
            "splunk": "OriginalFileName IN (\"PowerShell.EXE\", \"pwsh.dll\") OR Image IN (\"*\\\\powershell.exe\", \"*\\\\pwsh.exe\") CommandLine IN (\"*-executionpolicy *\", \"* -ep *\", \"* -exec *\") CommandLine IN (\"*Bypass*\", \"*Unrestricted*\")",
            "elastic": "((process.pe.original_file_name:(PowerShell.EXE OR pwsh.dll)) OR (process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe))) AND (process.command_line:(\"*\\-executionpolicy\\ *\" OR \"*\\ \\-ep\\ *\" OR \"*\\ \\-exec\\ *\")) AND (process.command_line:(*Bypass* OR *Unrestricted*))",
            "insightidr": "(OriginalFileName IIN [\"PowerShell.EXE\", \"pwsh.dll\"] OR Image=/(.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$)/i) AND (CommandLine ICONTAINS-ANY [\"-executionpolicy \", \" -ep \", \" -exec \"]) AND (CommandLine ICONTAINS-ANY [\"Bypass\", \"Unrestricted\"])"
        },
        {
            "name": "Non Interactive PowerShell Process Spawned",
            "splunk": "Image IN (\"*\\\\powershell.exe\", \"*\\\\pwsh.exe\") OR OriginalFileName IN (\"PowerShell.EXE\", \"pwsh.dll\") NOT (ParentImage IN (\"*:\\\\Windows\\\\explorer.exe\", \"*:\\\\Windows\\\\System32\\\\CompatTelRunner.exe\", \"*:\\\\Windows\\\\SysWOW64\\\\explorer.exe\") OR ParentImage=\":\\\\$WINDOWS.~BT\\\\Sources\\\\SetupHost.exe\") NOT ((ParentImage=\"*\\\\AppData\\\\Local\\\\Programs\\\\Microsoft VS Code\\\\Code.exe\" ParentCommandLine=\"* --ms-enable-electron-run-as-node *\") OR (ParentImage=\"*:\\\\Program Files\\\\WindowsApps\\\\Microsoft.WindowsTerminal_*\" ParentImage=\"*\\\\WindowsTerminal.exe\"))",
            "elastic": "((process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe)) OR (process.pe.original_file_name:(PowerShell.EXE OR pwsh.dll))) AND (NOT ((process.parent.executable:(*\\:\\\\Windows\\\\explorer.exe OR *\\:\\\\Windows\\\\System32\\\\CompatTelRunner.exe OR *\\:\\\\Windows\\\\SysWOW64\\\\explorer.exe)) OR process.parent.executable:\\:\\\\$WINDOWS.\\~BT\\\\Sources\\\\SetupHost.exe)) AND (NOT ((process.parent.executable:\"*\\\\AppData\\\\Local\\\\Programs\\\\Microsoft\\ VS\\ Code\\\\Code.exe\" AND process.parent.command_line:\"*\\ \\-\\-ms\\-enable\\-electron\\-run\\-as\\-node\\ *\") OR (process.parent.executable:\"*\\:\\\\Program\\ Files\\\\WindowsApps\\\\Microsoft.WindowsTerminal_*\" AND process.parent.executable:*\\\\WindowsTerminal.exe)))",
            "insightidr": "(Image=/(.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$)/i OR OriginalFileName IIN [\"PowerShell.EXE\", \"pwsh.dll\"]) AND NOT (ParentImage=/(.*:\\\\Windows\\\\explorer\\.exe$|.*:\\\\Windows\\\\System32\\\\CompatTelRunner\\.exe$|.*:\\\\Windows\\\\SysWOW64\\\\explorer\\.exe$)/i OR ParentImage = NOCASE(\":\\$WINDOWS.~BT\\Sources\\SetupHost.exe\")) AND NOT (ParentImage=/.*\\\\AppData\\\\Local\\\\Programs\\\\Microsoft\\ VS\\ Code\\\\Code\\.exe$/i AND ParentCommandLine ICONTAINS \" --ms-enable-electron-run-as-node \" OR ParentImage ICONTAINS \":\\Program Files\\WindowsApps\\Microsoft.WindowsTerminal_\" AND ParentImage=/.*\\\\WindowsTerminal\\.exe$/i)"
        },
        {
            "name": "Suspicious PowerShell Invocations - Specific - ProcessCreation",
            "splunk": "(CommandLine=\"*-nop*\" CommandLine=\"* -w *\" CommandLine=\"*hidden*\" CommandLine=\"* -c *\" CommandLine=\"*[Convert]::FromBase64String*\") OR (CommandLine=\"* -w *\" CommandLine=\"*hidden*\" CommandLine=\"*-noni*\" CommandLine=\"*-nop*\" CommandLine=\"* -c *\" CommandLine=\"*iex*\" CommandLine=\"*New-Object*\") OR (CommandLine=\"* -w *\" CommandLine=\"*hidden*\" CommandLine=\"*-ep*\" CommandLine=\"*bypass*\" CommandLine=\"*-Enc*\") OR (CommandLine=\"*powershell*\" CommandLine=\"*reg*\" CommandLine=\"*add*\" CommandLine=\"*\\\\software\\\\*\") OR (CommandLine=\"*bypass*\" CommandLine=\"*-noprofile*\" CommandLine=\"*-windowstyle*\" CommandLine=\"*hidden*\" CommandLine=\"*new-object*\" CommandLine=\"*system.net.webclient*\" CommandLine=\"*.download*\") OR (CommandLine=\"*iex*\" CommandLine=\"*New-Object*\" CommandLine=\"*Net.WebClient*\" CommandLine=\"*.Download*\") NOT (CommandLine IN (\"*(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1*\", \"*Write-ChocolateyWarning*\"))",
            "elastic": "((process.command_line:*\\-nop* AND process.command_line:\"*\\ \\-w\\ *\" AND process.command_line:*hidden* AND process.command_line:\"*\\ \\-c\\ *\" AND process.command_line:*\\[Convert\\]\\:\\:FromBase64String*) OR (process.command_line:\"*\\ \\-w\\ *\" AND process.command_line:*hidden* AND process.command_line:*\\-noni* AND process.command_line:*\\-nop* AND process.command_line:\"*\\ \\-c\\ *\" AND process.command_line:*iex* AND process.command_line:*New\\-Object*) OR (process.command_line:\"*\\ \\-w\\ *\" AND process.command_line:*hidden* AND process.command_line:*\\-ep* AND process.command_line:*bypass* AND process.command_line:*\\-Enc*) OR (process.command_line:*powershell* AND process.command_line:*reg* AND process.command_line:*add* AND process.command_line:*\\\\software\\\\*) OR (process.command_line:*bypass* AND process.command_line:*\\-noprofile* AND process.command_line:*\\-windowstyle* AND process.command_line:*hidden* AND process.command_line:*new\\-object* AND process.command_line:*system.net.webclient* AND process.command_line:*.download*) OR (process.command_line:*iex* AND process.command_line:*New\\-Object* AND process.command_line:*Net.WebClient* AND process.command_line:*.Download*)) AND (NOT (process.command_line:(\"*\\(New\\-Object\\ System.Net.WebClient\\).DownloadString\\('https\\:\\/\\/community.chocolatey.org\\/install.ps1*\" OR *Write\\-ChocolateyWarning*)))",
            "insightidr": "(CommandLine ICONTAINS-ALL [\"-nop\", \" -w \", \"hidden\", \" -c \", \"[Convert]::FromBase64String\"] OR CommandLine ICONTAINS-ALL [\" -w \", \"hidden\", \"-noni\", \"-nop\", \" -c \", \"iex\", \"New-Object\"] OR CommandLine ICONTAINS-ALL [\" -w \", \"hidden\", \"-ep\", \"bypass\", \"-Enc\"] OR CommandLine ICONTAINS-ALL [\"powershell\", \"reg\", \"add\", \"\\software\\\"] OR CommandLine ICONTAINS-ALL [\"bypass\", \"-noprofile\", \"-windowstyle\", \"hidden\", \"new-object\", \"system.net.webclient\", \".download\"] OR CommandLine ICONTAINS-ALL [\"iex\", \"New-Object\", \"Net.WebClient\", \".Download\"]) AND NOT (CommandLine ICONTAINS-ANY [\"\"\"(New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1\"\"\", \"Write-ChocolateyWarning\"])"
        },
        {
            "name": "Suspicious Execution of Powershell with Base64",
            "splunk": "Image IN (\"*\\\\powershell.exe\", \"*\\\\pwsh.exe\") CommandLine IN (\"* -e *\", \"* -en *\", \"* -enc *\", \"* -enco*\", \"* -ec *\") NOT (CommandLine=\"* -Encoding *\" OR ParentImage IN (\"*C:\\\\Packages\\\\Plugins\\\\Microsoft.GuestConfiguration.ConfigurationforWindows\\\\*\", \"*\\\\gc_worker.exe*\"))",
            "elastic": "((process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe)) AND (process.command_line:(\"*\\ \\-e\\ *\" OR \"*\\ \\-en\\ *\" OR \"*\\ \\-enc\\ *\" OR \"*\\ \\-enco*\" OR \"*\\ \\-ec\\ *\"))) AND (NOT (process.command_line:\"*\\ \\-Encoding\\ *\" OR (process.parent.executable:(*C\\:\\\\Packages\\\\Plugins\\\\Microsoft.GuestConfiguration.ConfigurationforWindows\\\\* OR *\\\\gc_worker.exe*))))",
            "insightidr": "(Image=/(.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$)/i) AND (CommandLine ICONTAINS-ANY [\" -e \", \" -en \", \" -enc \", \" -enco\", \" -ec \"]) AND NOT (CommandLine ICONTAINS \" -Encoding \" OR ParentImage ICONTAINS-ANY [\"C:\\Packages\\Plugins\\Microsoft.GuestConfiguration.ConfigurationforWindows\\\", \"\\gc_worker.exe\"])"
        },
        {
            "name": "Powershell Defender Exclusion",
            "splunk": "CommandLine IN (\"*Add-MpPreference *\", \"*Set-MpPreference *\") CommandLine IN (\"* -ExclusionPath *\", \"* -ExclusionExtension *\", \"* -ExclusionProcess *\", \"* -ExclusionIpAddress *\")",
            "elastic": "(process.command_line:(\"*Add\\-MpPreference\\ *\" OR \"*Set\\-MpPreference\\ *\")) AND (process.command_line:(\"*\\ \\-ExclusionPath\\ *\" OR \"*\\ \\-ExclusionExtension\\ *\" OR \"*\\ \\-ExclusionProcess\\ *\" OR \"*\\ \\-ExclusionIpAddress\\ *\"))",
            "insightidr": "(CommandLine ICONTAINS-ANY [\"Add-MpPreference \", \"Set-MpPreference \"]) AND (CommandLine ICONTAINS-ANY [\" -ExclusionPath \", \" -ExclusionExtension \", \" -ExclusionProcess \", \" -ExclusionIpAddress \"])"
        },
        {
            "name": "Suspicious Encoded PowerShell Command Line",
            "splunk": "Image IN (\"*\\\\powershell.exe\", \"*\\\\pwsh.exe\") OR OriginalFileName IN (\"PowerShell.EXE\", \"pwsh.dll\") (CommandLine=\"* -e*\" CommandLine IN (\"* JAB*\", \"* SUVYI*\", \"* SQBFAFgA*\", \"* aQBlAHgA*\", \"* aWV4I*\", \"* IAA*\", \"* IAB*\", \"* UwB*\", \"* cwB*\")) OR CommandLine IN (\"*.exe -ENCOD *\", \"* BA^J e-*\") NOT CommandLine=\"* -ExecutionPolicy remotesigned *\"",
            "elastic": "((process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe)) OR (process.pe.original_file_name:(PowerShell.EXE OR pwsh.dll))) AND ((process.command_line:\"*\\ \\-e*\" AND (process.command_line:(\"*\\ JAB*\" OR \"*\\ SUVYI*\" OR \"*\\ SQBFAFgA*\" OR \"*\\ aQBlAHgA*\" OR \"*\\ aWV4I*\" OR \"*\\ IAA*\" OR \"*\\ IAB*\" OR \"*\\ UwB*\" OR \"*\\ cwB*\"))) OR (process.command_line:(\"*.exe\\ \\-ENCOD\\ *\" OR \"*\\ BA\\^J\\ e\\-*\"))) AND (NOT process.command_line:\"*\\ \\-ExecutionPolicy\\ remotesigned\\ *\")",
            "insightidr": "(Image=/(.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$)/i OR OriginalFileName IIN [\"PowerShell.EXE\", \"pwsh.dll\"]) AND (CommandLine ICONTAINS \" -e\" AND (CommandLine ICONTAINS-ANY [\" JAB\", \" SUVYI\", \" SQBFAFgA\", \" aQBlAHgA\", \" aWV4I\", \" IAA\", \" IAB\", \" UwB\", \" cwB\"]) OR CommandLine ICONTAINS-ANY [\".exe -ENCOD \", \" BA^J e-\"]) AND NOT CommandLine ICONTAINS \" -ExecutionPolicy remotesigned \""
        },
        {
            "name": "New Firewall Rule Added Via Netsh.EXE",
            "splunk": "Image=\"*\\\\netsh.exe\" OR OriginalFileName=\"netsh.exe\" CommandLine=\"* firewall *\" CommandLine=\"* add *\" NOT (CommandLine IN (\"*advfirewall firewall add rule name=Dropbox dir=in action=allow \\\"program=*:\\\\Program Files (x86)\\\\Dropbox\\\\Client\\\\Dropbox.exe\\\" enable=yes profile=Any*\", \"*advfirewall firewall add rule name=Dropbox dir=in action=allow \\\"program=*:\\\\Program Files\\\\Dropbox\\\\Client\\\\Dropbox.exe\\\" enable=yes profile=Any*\"))",
            "elastic": "((process.executable:*\\\\netsh.exe OR process.pe.original_file_name:netsh.exe) AND (process.command_line:\"*\\ firewall\\ *\" AND process.command_line:\"*\\ add\\ *\")) AND (NOT (process.command_line:(\"*advfirewall\\ firewall\\ add\\ rule\\ name\\=Dropbox\\ dir\\=in\\ action\\=allow\\ \\\"program\\=?\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Dropbox\\\\Client\\\\Dropbox.exe\\\"\\ enable\\=yes\\ profile\\=Any*\" OR \"*advfirewall\\ firewall\\ add\\ rule\\ name\\=Dropbox\\ dir\\=in\\ action\\=allow\\ \\\"program\\=?\\:\\\\Program\\ Files\\\\Dropbox\\\\Client\\\\Dropbox.exe\\\"\\ enable\\=yes\\ profile\\=Any*\")))",
            "insightidr": "(Image=/.*\\\\netsh\\.exe$/i OR OriginalFileName = NOCASE(\"netsh.exe\")) AND CommandLine ICONTAINS-ALL [\" firewall \", \" add \"] AND NOT (CommandLine ICONTAINS-ANY ['advfirewall firewall add rule name=Dropbox dir=in action=allow \"program=?:\\Program Files (x86)\\Dropbox\\Client\\Dropbox.exe\" enable=yes profile=Any', 'advfirewall firewall add rule name=Dropbox dir=in action=allow \"program=?:\\Program Files\\Dropbox\\Client\\Dropbox.exe\" enable=yes profile=Any'])"
        },
        {
            "name": "Suspicious Msbuild Execution By Uncommon Parent Process",
            "splunk": "Image=\"*\\\\MSBuild.exe\" OR OriginalFileName=\"MSBuild.exe\" NOT (ParentImage IN (\"*\\\\devenv.exe\", \"*\\\\cmd.exe\", \"*\\\\msbuild.exe\", \"*\\\\python.exe\", \"*\\\\explorer.exe\", \"*\\\\nuget.exe\"))",
            "elastic": "(process.executable:*\\\\MSBuild.exe OR process.pe.original_file_name:MSBuild.exe) AND (NOT (process.parent.executable:(*\\\\devenv.exe OR *\\\\cmd.exe OR *\\\\msbuild.exe OR *\\\\python.exe OR *\\\\explorer.exe OR *\\\\nuget.exe)))",
            "insightidr": "(Image=/.*\\\\MSBuild\\.exe$/i OR OriginalFileName = NOCASE(\"MSBuild.exe\")) AND NOT (ParentImage=/(.*\\\\devenv\\.exe$|.*\\\\cmd\\.exe$|.*\\\\msbuild\\.exe$|.*\\\\python\\.exe$|.*\\\\explorer\\.exe$|.*\\\\nuget\\.exe$)/i)"
        },
        {
            "name": "Use Icacls to Hide File to Everyone",
            "splunk": "OriginalFileName=\"iCACLS.EXE\" OR Image=\"*\\\\icacls.exe\" CommandLine=\"*C:\\\\Users\\\\*\" CommandLine=\"*/deny*\" CommandLine=\"*S-1-1-0:*\"",
            "elastic": "(process.pe.original_file_name:iCACLS.EXE OR process.executable:*\\\\icacls.exe) AND (process.command_line:*C\\:\\\\Users\\\\* AND process.command_line:*\\/deny* AND process.command_line:*S\\-1\\-1\\-0\\:*)",
            "insightidr": "(OriginalFileName = NOCASE(\"iCACLS.EXE\") OR Image=/.*\\\\icacls\\.exe$/i) AND CommandLine ICONTAINS-ALL [\"C:\\Users\\\", \"/deny\", \"S-1-1-0:\"]"
        },
        {
            "name": "Forfiles Command Execution",
            "splunk": "Image=\"*\\\\forfiles.exe\" OR OriginalFileName=\"forfiles.exe\" CommandLine IN (\"* /c *\", \"* -c *\")",
            "elastic": "(process.executable:*\\\\forfiles.exe OR process.pe.original_file_name:forfiles.exe) AND (process.command_line:(\"*\\ \\/c\\ *\" OR \"*\\ \\-c\\ *\"))",
            "insightidr": "(Image=/.*\\\\forfiles\\.exe$/i OR OriginalFileName = NOCASE(\"forfiles.exe\")) AND (CommandLine ICONTAINS-ANY [\" /c \", \" -c \"])"
        },
        {
            "name": "Uncommon Child Process Of Conhost.EXE",
            "splunk": "ParentImage=\"*\\\\conhost.exe\" NOT (Image=\"*:\\\\Windows\\\\System32\\\\conhost.exe\" OR Image!=* OR Image=\"\") NOT Provider_Name=\"SystemTraceProvider-Process\"",
            "elastic": "process.parent.executable:*\\\\conhost.exe AND (NOT (process.executable:*\\:\\\\Windows\\\\System32\\\\conhost.exe OR (NOT _exists_:process.executable) OR process.executable:\"\")) AND (NOT winlog.provider_name:SystemTraceProvider\\-Process)",
            "insightidr": "ParentImage=/.*\\\\conhost\\.exe$/i AND NOT (Image=/.*:\\\\Windows\\\\System32\\\\conhost\\.exe$/i OR Image = null OR Image = NOCASE(\"\")) AND NOT Provider_Name = NOCASE(\"SystemTraceProvider-Process\")"
        },
        {
            "name": "Unusual Parent Process For Cmd.EXE",
            "splunk": "Image=\"*\\\\cmd.exe\" ParentImage IN (\"*\\\\csrss.exe\", \"*\\\\ctfmon.exe\", \"*\\\\dllhost.exe\", \"*\\\\epad.exe\", \"*\\\\FlashPlayerUpdateService.exe\", \"*\\\\GoogleUpdate.exe\", \"*\\\\jucheck.exe\", \"*\\\\jusched.exe\", \"*\\\\LogonUI.exe\", \"*\\\\lsass.exe\", \"*\\\\regsvr32.exe\", \"*\\\\SearchIndexer.exe\", \"*\\\\SearchProtocolHost.exe\", \"*\\\\SIHClient.exe\", \"*\\\\sihost.exe\", \"*\\\\slui.exe\", \"*\\\\spoolsv.exe\", \"*\\\\sppsvc.exe\", \"*\\\\taskhostw.exe\", \"*\\\\unsecapp.exe\", \"*\\\\WerFault.exe\", \"*\\\\wermgr.exe\", \"*\\\\wlanext.exe\", \"*\\\\WUDFHost.exe\")",
            "elastic": "process.executable:*\\\\cmd.exe AND (process.parent.executable:(*\\\\csrss.exe OR *\\\\ctfmon.exe OR *\\\\dllhost.exe OR *\\\\epad.exe OR *\\\\FlashPlayerUpdateService.exe OR *\\\\GoogleUpdate.exe OR *\\\\jucheck.exe OR *\\\\jusched.exe OR *\\\\LogonUI.exe OR *\\\\lsass.exe OR *\\\\regsvr32.exe OR *\\\\SearchIndexer.exe OR *\\\\SearchProtocolHost.exe OR *\\\\SIHClient.exe OR *\\\\sihost.exe OR *\\\\slui.exe OR *\\\\spoolsv.exe OR *\\\\sppsvc.exe OR *\\\\taskhostw.exe OR *\\\\unsecapp.exe OR *\\\\WerFault.exe OR *\\\\wermgr.exe OR *\\\\wlanext.exe OR *\\\\WUDFHost.exe))",
            "insightidr": "Image=/.*\\\\cmd\\.exe$/i AND (ParentImage=/(.*\\\\csrss\\.exe$|.*\\\\ctfmon\\.exe$|.*\\\\dllhost\\.exe$|.*\\\\epad\\.exe$|.*\\\\FlashPlayerUpdateService\\.exe$|.*\\\\GoogleUpdate\\.exe$|.*\\\\jucheck\\.exe$|.*\\\\jusched\\.exe$|.*\\\\LogonUI\\.exe$|.*\\\\lsass\\.exe$|.*\\\\regsvr32\\.exe$|.*\\\\SearchIndexer\\.exe$|.*\\\\SearchProtocolHost\\.exe$|.*\\\\SIHClient\\.exe$|.*\\\\sihost\\.exe$|.*\\\\slui\\.exe$|.*\\\\spoolsv\\.exe$|.*\\\\sppsvc\\.exe$|.*\\\\taskhostw\\.exe$|.*\\\\unsecapp\\.exe$|.*\\\\WerFault\\.exe$|.*\\\\wermgr\\.exe$|.*\\\\wlanext\\.exe$|.*\\\\WUDFHost\\.exe$)/i)"
        },
        {
            "name": "Read Contents From Stdin Via Cmd.EXE",
            "splunk": "OriginalFileName=\"Cmd.Exe\" OR Image=\"*\\\\cmd.exe\" CommandLine=\"*<*\"",
            "elastic": "(process.pe.original_file_name:Cmd.Exe OR process.executable:*\\\\cmd.exe) AND process.command_line:*\\<*",
            "insightidr": "(OriginalFileName = NOCASE(\"Cmd.Exe\") OR Image=/.*\\\\cmd\\.exe$/i) AND CommandLine ICONTAINS \"<\""
        },
        {
            "name": "CMD Shell Output Redirect",
            "splunk": "OriginalFileName=\"Cmd.Exe\" OR Image=\"*\\\\cmd.exe\" CommandLine=\"*>*\" NOT (CommandLine IN (\"*C:\\\\Program Files (x86)\\\\Internet Download Manager\\\\IDMMsgHost.exe*\", \"*chrome-extension://*\", \"*\\\\.\\\\pipe\\\\chrome.nativeMessaging*\"))",
            "elastic": "((process.pe.original_file_name:Cmd.Exe OR process.executable:*\\\\cmd.exe) AND process.command_line:*\\>*) AND (NOT (process.command_line:(\"*C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Internet\\ Download\\ Manager\\\\IDMMsgHost.exe*\" OR *chrome\\-extension\\:\\/\\/* OR *\\\\.\\\\pipe\\\\chrome.nativeMessaging*)))",
            "insightidr": "(OriginalFileName = NOCASE(\"Cmd.Exe\") OR Image=/.*\\\\cmd\\.exe$/i) AND CommandLine ICONTAINS \">\" AND NOT (CommandLine ICONTAINS-ANY [\"C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe\", \"chrome-extension://\", \"\\.\\pipe\\chrome.nativeMessaging\"])"
        },
        {
            "name": "Greedy File Deletion Using Del",
            "splunk": "Image=\"*\\\\cmd.exe\" OR OriginalFileName=\"Cmd.Exe\" CommandLine IN (\"*del *\", \"*erase *\") CommandLine IN (\"*\\\\\\*.au3*\", \"*\\\\\\*.dll*\", \"*\\\\\\*.exe*\", \"*\\\\\\*.js*\")",
            "elastic": "(process.executable:*\\\\cmd.exe OR process.pe.original_file_name:Cmd.Exe) AND (process.command_line:(\"*del\\ *\" OR \"*erase\\ *\")) AND (process.command_line:(*\\\\\\*.au3* OR *\\\\\\*.dll* OR *\\\\\\*.exe* OR *\\\\\\*.js*))",
            "insightidr": "(Image=/.*\\\\cmd\\.exe$/i OR OriginalFileName = NOCASE(\"Cmd.Exe\")) AND (CommandLine ICONTAINS-ANY [\"del \", \"erase \"]) AND (CommandLine ICONTAINS-ANY [\"\\*.au3\", \"\\*.dll\", \"\\*.exe\", \"\\*.js\"])"
        },
        {
            "name": "Set Files as System Files Using Attrib.EXE",
            "splunk": "Image=\"*\\\\attrib.exe\" OR OriginalFileName=\"ATTRIB.EXE\" CommandLine=\"* +s *\"",
            "elastic": "(process.executable:*\\\\attrib.exe OR process.pe.original_file_name:ATTRIB.EXE) AND process.command_line:\"*\\ \\+s\\ *\"",
            "insightidr": "(Image=/.*\\\\attrib\\.exe$/i OR OriginalFileName = NOCASE(\"ATTRIB.EXE\")) AND CommandLine ICONTAINS \" +s \""
        },
        {
            "name": "AspNetCompiler Execution",
            "splunk": "Image IN (\"*C:\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\*\", \"*C:\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\*\") Image=\"*\\\\aspnet_compiler.exe\"",
            "elastic": "(process.executable:(*C\\:\\\\Windows\\\\Microsoft.NET\\\\Framework\\\\* OR *C\\:\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\*)) AND process.executable:*\\\\aspnet_compiler.exe",
            "insightidr": "(Image ICONTAINS-ANY [\"C:\\Windows\\Microsoft.NET\\Framework\\\", \"C:\\Windows\\Microsoft.NET\\Framework64\\\"]) AND Image=/.*\\\\aspnet_compiler\\.exe$/i"
        },
        {
            "name": "Suspicious Outbound SMTP Connections",
            "splunk": "DestinationPort IN (25, 587, 465, 2525) Initiated=\"true\" NOT (Image IN (\"*\\\\thunderbird.exe\", \"*\\\\outlook.exe\") OR Image=\"C:\\\\Program Files\\\\Microsoft\\\\Exchange Server\\\\*\" OR (Image=\"C:\\\\Program Files\\\\WindowsApps\\\\microsoft.windowscommunicationsapps_*\" Image=\"*\\\\HxTsr.exe\"))",
            "elastic": "((destination.port:(25 OR 587 OR 465 OR 2525)) AND network.direction:true) AND (NOT ((process.executable:(*\\\\thunderbird.exe OR *\\\\outlook.exe)) OR process.executable:\"C\\:\\\\Program\\ Files\\\\Microsoft\\\\Exchange\\ Server\\\\*\" OR (process.executable:\"C\\:\\\\Program\\ Files\\\\WindowsApps\\\\microsoft.windowscommunicationsapps_*\" AND process.executable:*\\\\HxTsr.exe)))",
            "insightidr": "(DestinationPort IIN [\"25\", \"587\", \"465\", \"2525\"]) AND Initiated = NOCASE(\"true\") AND NOT (Image=/(.*\\\\thunderbird\\.exe$|.*\\\\outlook\\.exe$)/i OR Image ISTARTS-WITH \"C:\\Program Files\\Microsoft\\Exchange Server\\\" OR Image ICONTAINS-ALL [\"C:\\Program Files\\WindowsApps\\microsoft.windowscommunicationsapps_\", \"\\HxTsr.exe\"])"
        },
        {
            "name": "Silenttrinity Stager Msbuild Activity",
            "splunk": "Image=\"*\\\\msbuild.exe\" DestinationPort IN (80, 443) Initiated=\"true\"",
            "elastic": "process.executable:*\\\\msbuild.exe AND ((destination.port:(80 OR 443)) AND network.direction:true)",
            "insightidr": "Image=/.*\\\\msbuild\\.exe$/i AND (DestinationPort IIN [\"80\", \"443\"]) AND Initiated = NOCASE(\"true\")"
        },
        {
            "name": "Rundll32 Internet Connection",
            "splunk": "Image=\"*\\\\rundll32.exe\" Initiated=\"true\" NOT (DestinationIp IN (\"10.*\", \"192.168.*\", \"172.16.*\", \"172.17.*\", \"172.18.*\", \"172.19.*\", \"172.20.*\", \"172.21.*\", \"172.22.*\", \"172.23.*\", \"172.24.*\", \"172.25.*\", \"172.26.*\", \"172.27.*\", \"172.28.*\", \"172.29.*\", \"172.30.*\", \"172.31.*\", \"127.*\", \"20.*\", \"51.103.*\", \"51.104.*\", \"51.105.*\") OR CommandLine=\"*PcaSvc.dll,PcaPatchSdbTask*\" OR SourceHostname=\"*.internal.cloudapp.net\" OR (ParentImage=\"C:\\\\Windows\\\\System32\\\\svchost.exe\" DestinationPort=443))",
            "elastic": "(process.executable:*\\\\rundll32.exe AND network.direction:true) AND (NOT (((destination.ip:(10.* OR 192.168.* OR 172.16.* OR 172.17.* OR 172.18.* OR 172.19.* OR 172.20.* OR 172.21.* OR 172.22.* OR 172.23.* OR 172.24.* OR 172.25.* OR 172.26.* OR 172.27.* OR 172.28.* OR 172.29.* OR 172.30.* OR 172.31.* OR 127.* OR 20.* OR 51.103.* OR 51.104.* OR 51.105.*)) OR winlog.event_data.CommandLine:*PcaSvc.dll,PcaPatchSdbTask* OR source.domain:*.internal.cloudapp.net) OR (process.parent.executable:C\\:\\\\Windows\\\\System32\\\\svchost.exe AND destination.port:443)))",
            "insightidr": "Image=/.*\\\\rundll32\\.exe$/i AND Initiated = NOCASE(\"true\") AND NOT (DestinationIp ISTARTS-WITH-ANY [\"10.\", \"192.168.\", \"172.16.\", \"172.17.\", \"172.18.\", \"172.19.\", \"172.20.\", \"172.21.\", \"172.22.\", \"172.23.\", \"172.24.\", \"172.25.\", \"172.26.\", \"172.27.\", \"172.28.\", \"172.29.\", \"172.30.\", \"172.31.\", \"127.\", \"20.\", \"51.103.\", \"51.104.\", \"51.105.\"] OR CommandLine ICONTAINS \"PcaSvc.dll,PcaPatchSdbTask\" OR SourceHostname=/.*\\.internal\\.cloudapp\\.net$/i OR ParentImage = NOCASE(\"C:\\Windows\\System32\\svchost.exe\") AND DestinationPort=443)"
        },
        {
            "name": "Notepad Making Network Connection",
            "splunk": "Image=\"*\\\\notepad.exe\" NOT DestinationPort=9100",
            "elastic": "process.executable:*\\\\notepad.exe AND (NOT destination.port:9100)",
            "insightidr": "Image=/.*\\\\notepad\\.exe$/i AND NOT DestinationPort=9100"
        },
        {
            "name": "Unsigned DLL Loaded by RunDLL32/RegSvr32",
            "splunk": "Image IN (\"*\\\\regsvr32.exe\", \"*\\\\rundll32.exe\") NOT (Signed=\"true\" OR SignatureStatus IN (\"errorChaining\", \"errorCode_endpoint\", \"errorExpired\", \"trusted\"))",
            "elastic": "(process.executable:(*\\\\regsvr32.exe OR *\\\\rundll32.exe)) AND (NOT (file.code_signature.signed:true OR (file.code_signature.status:(errorChaining OR errorCode_endpoint OR errorExpired OR trusted))))",
            "insightidr": "(Image=/(.*\\\\regsvr32\\.exe$|.*\\\\rundll32\\.exe$)/i) AND NOT (Signed = NOCASE(\"true\") OR SignatureStatus IIN [\"errorChaining\", \"errorCode_endpoint\", \"errorExpired\", \"trusted\"])"
        },
        {
            "name": "Startup Folder File Write",
            "splunk": "TargetFilename=\"*\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\StartUp*\" NOT (Image=\"C:\\\\Windows\\\\System32\\\\wuauclt.exe\" OR TargetFilename=\"C:\\\\$WINDOWS.~BT\\\\NewOS\\\\*\")",
            "elastic": "file.path:\"*\\\\Microsoft\\\\Windows\\\\Start\\ Menu\\\\Programs\\\\StartUp*\" AND (NOT (process.executable:C\\:\\\\Windows\\\\System32\\\\wuauclt.exe OR file.path:C\\:\\\\$WINDOWS.\\~BT\\\\NewOS\\\\*))",
            "insightidr": "TargetFilename ICONTAINS \"\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\" AND NOT (Image = NOCASE(\"C:\\Windows\\System32\\wuauclt.exe\") OR TargetFilename ISTARTS-WITH \"C:\\$WINDOWS.~BT\\NewOS\\\")"
        },
        {
            "name": "Windows Binaries Write Suspicious Extensions",
            "splunk": "(Image IN (\"*\\\\smss.exe\", \"*\\\\RuntimeBroker.exe\", \"*\\\\sihost.exe\", \"*\\\\lsass.exe\", \"*\\\\csrss.exe\", \"*\\\\winlogon.exe\", \"*\\\\wininit.exe\") TargetFilename IN (\"*.bat\", \"*.vbe\", \"*.txt\", \"*.vbs\", \"*.exe\", \"*.ps1\", \"*.hta\", \"*.iso\", \"*.dll\")) OR (Image IN (\"*\\\\rundll32.exe\", \"*\\\\svchost.exe\", \"*\\\\dllhost.exe\") TargetFilename IN (\"*.bat\", \"*.vbe\", \"*.vbs\", \"*.ps1\", \"*.hta\", \"*.iso\"))",
            "elastic": "((process.executable:(*\\\\smss.exe OR *\\\\RuntimeBroker.exe OR *\\\\sihost.exe OR *\\\\lsass.exe OR *\\\\csrss.exe OR *\\\\winlogon.exe OR *\\\\wininit.exe)) AND (file.path:(*.bat OR *.vbe OR *.txt OR *.vbs OR *.exe OR *.ps1 OR *.hta OR *.iso OR *.dll))) OR ((process.executable:(*\\\\rundll32.exe OR *\\\\svchost.exe OR *\\\\dllhost.exe)) AND (file.path:(*.bat OR *.vbe OR *.vbs OR *.ps1 OR *.hta OR *.iso)))",
            "insightidr": "(Image=/(.*\\\\smss\\.exe$|.*\\\\RuntimeBroker\\.exe$|.*\\\\sihost\\.exe$|.*\\\\lsass\\.exe$|.*\\\\csrss\\.exe$|.*\\\\winlogon\\.exe$|.*\\\\wininit\\.exe$)/i) AND (TargetFilename=/(.*\\.bat$|.*\\.vbe$|.*\\.txt$|.*\\.vbs$|.*\\.exe$|.*\\.ps1$|.*\\.hta$|.*\\.iso$|.*\\.dll$)/i) OR (Image=/(.*\\\\rundll32\\.exe$|.*\\\\svchost\\.exe$|.*\\\\dllhost\\.exe$)/i) AND (TargetFilename=/(.*\\.bat$|.*\\.vbe$|.*\\.vbs$|.*\\.ps1$|.*\\.hta$|.*\\.iso$)/i)"
        },
        {
            "name": "PSScriptPolicyTest Creation By Uncommon Process",
            "splunk": "TargetFilename=\"*__PSScriptPolicyTest_*\" NOT (Image IN (\"*:\\\\Program Files\\\\PowerShell\\\\7-preview\\\\pwsh.exe\", \"*:\\\\Program Files\\\\PowerShell\\\\7\\\\pwsh.exe\", \"*:\\\\Windows\\\\System32\\\\dsac.exe\", \"*:\\\\Windows\\\\System32\\\\sdiagnhost.exe\", \"*:\\\\Windows\\\\System32\\\\ServerManager.exe\", \"*:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \"*:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\", \"*:\\\\Windows\\\\System32\\\\wsmprovhost.exe\", \"*:\\\\Windows\\\\SysWOW64\\\\sdiagnhost.exe\", \"*:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe\", \"*:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\"))",
            "elastic": "file.path:*__PSScriptPolicyTest_* AND (NOT (process.executable:(\"*\\:\\\\Program\\ Files\\\\PowerShell\\\\7\\-preview\\\\pwsh.exe\" OR \"*\\:\\\\Program\\ Files\\\\PowerShell\\\\7\\\\pwsh.exe\" OR *\\:\\\\Windows\\\\System32\\\\dsac.exe OR *\\:\\\\Windows\\\\System32\\\\sdiagnhost.exe OR *\\:\\\\Windows\\\\System32\\\\ServerManager.exe OR *\\:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe OR *\\:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe OR *\\:\\\\Windows\\\\System32\\\\wsmprovhost.exe OR *\\:\\\\Windows\\\\SysWOW64\\\\sdiagnhost.exe OR *\\:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell_ise.exe OR *\\:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe)))",
            "insightidr": "TargetFilename ICONTAINS \"__PSScriptPolicyTest_\" AND NOT (Image=/(.*:\\\\Program\\ Files\\\\PowerShell\\\\7\\-preview\\\\pwsh\\.exe$|.*:\\\\Program\\ Files\\\\PowerShell\\\\7\\\\pwsh\\.exe$|.*:\\\\Windows\\\\System32\\\\dsac\\.exe$|.*:\\\\Windows\\\\System32\\\\sdiagnhost\\.exe$|.*:\\\\Windows\\\\System32\\\\ServerManager\\.exe$|.*:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1\\.0\\\\powershell_ise\\.exe$|.*:\\\\Windows\\\\System32\\\\WindowsPowerShell\\\\v1\\.0\\\\powershell\\.exe$|.*:\\\\Windows\\\\System32\\\\wsmprovhost\\.exe$|.*:\\\\Windows\\\\SysWOW64\\\\sdiagnhost\\.exe$|.*:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1\\.0\\\\powershell_ise\\.exe$|.*:\\\\Windows\\\\SysWOW64\\\\WindowsPowerShell\\\\v1\\.0\\\\powershell\\.exe$)/i)"
        },
        {
            "name": "Potential Binary Or Script Dropper Via PowerShell",
            "splunk": "Image IN (\"*\\\\powershell.exe\", \"*\\\\pwsh.exe\") TargetFilename IN (\"*.bat\", \"*.chm\", \"*.cmd\", \"*.com\", \"*.dll\", \"*.exe\", \"*.hta\", \"*.jar\", \"*.js\", \"*.ocx\", \"*.scr\", \"*.sys\", \"*.vbe\", \"*.vbs\", \"*.wsf\") NOT ((TargetFilename=\"C:\\\\Users\\\\*\" TargetFilename=\"*\\\\AppData\\\\Local\\\\Temp\\\\*\" TargetFilename IN (\"*.dll\", \"*.exe\")) OR (TargetFilename=\"C:\\\\Windows\\\\Temp\\\\*\" TargetFilename IN (\"*.dll\", \"*.exe\")))",
            "elastic": "((process.executable:(*\\\\powershell.exe OR *\\\\pwsh.exe)) AND (file.path:(*.bat OR *.chm OR *.cmd OR *.com OR *.dll OR *.exe OR *.hta OR *.jar OR *.js OR *.ocx OR *.scr OR *.sys OR *.vbe OR *.vbs OR *.wsf))) AND (NOT ((file.path:C\\:\\\\Users\\\\* AND file.path:*\\\\AppData\\\\Local\\\\Temp\\\\* AND (file.path:(*.dll OR *.exe))) OR (file.path:C\\:\\\\Windows\\\\Temp\\\\* AND (file.path:(*.dll OR *.exe)))))",
            "insightidr": "(Image=/(.*\\\\powershell\\.exe$|.*\\\\pwsh\\.exe$)/i) AND (TargetFilename=/(.*\\.bat$|.*\\.chm$|.*\\.cmd$|.*\\.com$|.*\\.dll$|.*\\.exe$|.*\\.hta$|.*\\.jar$|.*\\.js$|.*\\.ocx$|.*\\.scr$|.*\\.sys$|.*\\.vbe$|.*\\.vbs$|.*\\.wsf$)/i) AND NOT (TargetFilename ISTARTS-WITH \"C:\\Users\\\" AND TargetFilename ICONTAINS \"\\AppData\\Local\\Temp\\\" AND (TargetFilename=/(.*\\.dll$|.*\\.exe$)/i) OR TargetFilename ISTARTS-WITH \"C:\\Windows\\Temp\\\" AND (TargetFilename=/(.*\\.dll$|.*\\.exe$)/i))"
        },
        {
            "name": "File Creation Date Changed to Another Year",
            "splunk": "(PreviousCreationUtcTime=\"2022*\" NOT CreationUtcTime=\"2022*\") OR (PreviousCreationUtcTime=\"202*\" NOT CreationUtcTime=\"202*\") NOT (Image IN (\"C:\\\\Windows\\\\system32\\\\ProvTool.exe\", \"C:\\\\Windows\\\\System32\\\\usocoreworker.exe\", \"C:\\\\Windows\\\\ImmersiveControlPanel\\\\SystemSettings.exe\") OR TargetFilename=\"C:\\\\ProgramData\\\\USOPrivate\\\\UpdateStore\\\\*\" OR TargetFilename IN (\"*.tmp\", \"*.temp\") OR (Image=\"C:\\\\WINDOWS\\\\*\" Image=\"*\\\\TiWorker.exe\" TargetFilename=\"*.cab\"))",
            "elastic": "((winlog.event_data.PreviousCreationUtcTime:2022* AND (NOT winlog.event_data.CreationUtcTime:2022*)) OR (winlog.event_data.PreviousCreationUtcTime:202* AND (NOT winlog.event_data.CreationUtcTime:202*))) AND (NOT (((process.executable:(C\\:\\\\Windows\\\\system32\\\\ProvTool.exe OR C\\:\\\\Windows\\\\System32\\\\usocoreworker.exe OR C\\:\\\\Windows\\\\ImmersiveControlPanel\\\\SystemSettings.exe)) OR file.path:C\\:\\\\ProgramData\\\\USOPrivate\\\\UpdateStore\\\\* OR (file.path:(*.tmp OR *.temp))) OR (process.executable:C\\:\\\\WINDOWS\\\\* AND process.executable:*\\\\TiWorker.exe AND file.path:*.cab)))",
            "insightidr": "(PreviousCreationUtcTime ISTARTS-WITH \"2022\" AND NOT CreationUtcTime ISTARTS-WITH \"2022\" OR PreviousCreationUtcTime ISTARTS-WITH \"202\" AND NOT CreationUtcTime ISTARTS-WITH \"202\") AND NOT (Image IIN [\"C:\\Windows\\system32\\ProvTool.exe\", \"C:\\Windows\\System32\\usocoreworker.exe\", \"C:\\Windows\\ImmersiveControlPanel\\SystemSettings.exe\"] OR TargetFilename ISTARTS-WITH \"C:\\ProgramData\\USOPrivate\\UpdateStore\\\" OR TargetFilename=/(.*\\.tmp$|.*\\.temp$)/i OR Image ISTARTS-WITH \"C:\\WINDOWS\\\" AND Image=/.*\\\\TiWorker\\.exe$/i AND TargetFilename=/.*\\.cab$/i)"
        },
        {
            "name": "Driver Load From A Temporary Directory",
            "splunk": "ImageLoaded=\"*\\\\Temp\\\\*\"",
            "elastic": "file.path:*\\\\Temp\\\\*",
            "insightidr": "ImageLoaded ICONTAINS \"\\Temp\\\""
        },
        {
            "name": "Suspicious DNS Query for IP Lookup Service APIs",
            "splunk": "QueryName IN (\"*api.2ip.ua*\", \"*api.bigdatacloud.net*\", \"*api.ipify.org*\", \"*bot.whatismyipaddress.com*\", \"*canireachthe.net*\", \"*checkip.amazonaws.com*\", \"*checkip.dyndns.org*\", \"*curlmyip.com*\", \"*db-ip.com*\", \"*edns.ip-api.com*\", \"*eth0.me*\", \"*freegeoip.app*\", \"*geoipy.com*\", \"*getip.pro*\", \"*icanhazip.com*\", \"*ident.me*\", \"*ifconfig.io*\", \"*ifconfig.me*\", \"*ipapi.co*\", \"*ip-api.com*\", \"*ip.anysrc.net*\", \"*ip.tyk.nu*\", \"*ipaddressworld.com*\", \"*ipecho.net*\", \"*ipinfo.io*\", \"*ipof.in*\", \"*ipv4.icanhazip.com*\", \"*ipv4bot.whatismyipaddress.com*\", \"*ipwho.is*\", \"*l2.io*\", \"*myexternalip.com*\", \"*wgetip.com*\", \"*whatismyip.akamai.com*\", \"*wtfismyip.com*\") NOT (Image=\"*\\\\brave.exe\" OR Image IN (\"C:\\\\Program Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\", \"C:\\\\Program Files (x86)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\") OR Image IN (\"C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\", \"C:\\\\Program Files (x86)\\\\Mozilla Firefox\\\\firefox.exe\") OR Image IN (\"C:\\\\Program Files (x86)\\\\Internet Explorer\\\\iexplore.exe\", \"C:\\\\Program Files\\\\Internet Explorer\\\\iexplore.exe\") OR Image=\"*\\\\maxthon.exe\" OR Image=\"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\*\" OR Image=\"*\\\\WindowsApps\\\\MicrosoftEdge.exe\" OR Image IN (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\", \"C:\\\\Program Files\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\") OR (Image IN (\"C:\\\\Program Files (x86)\\\\Microsoft\\\\EdgeCore\\\\*\", \"C:\\\\Program Files\\\\Microsoft\\\\EdgeCore\\\\*\") Image IN (\"*\\\\msedge.exe\", \"*\\\\msedgewebview2.exe\")) OR Image=\"*\\\\opera.exe\" OR Image=\"*\\\\safari.exe\" OR Image=\"*\\\\seamonkey.exe\" OR Image=\"*\\\\vivaldi.exe\" OR Image=\"*\\\\whale.exe\")",
            "elastic": "(dns.question.name:(*api.2ip.ua* OR *api.bigdatacloud.net* OR *api.ipify.org* OR *bot.whatismyipaddress.com* OR *canireachthe.net* OR *checkip.amazonaws.com* OR *checkip.dyndns.org* OR *curlmyip.com* OR *db\\-ip.com* OR *edns.ip\\-api.com* OR *eth0.me* OR *freegeoip.app* OR *geoipy.com* OR *getip.pro* OR *icanhazip.com* OR *ident.me* OR *ifconfig.io* OR *ifconfig.me* OR *ipapi.co* OR *ip\\-api.com* OR *ip.anysrc.net* OR *ip.tyk.nu* OR *ipaddressworld.com* OR *ipecho.net* OR *ipinfo.io* OR *ipof.in* OR *ipv4.icanhazip.com* OR *ipv4bot.whatismyipaddress.com* OR *ipwho.is* OR *l2.io* OR *myexternalip.com* OR *wgetip.com* OR *whatismyip.akamai.com* OR *wtfismyip.com*)) AND (NOT (process.executable:*\\\\brave.exe OR (process.executable:(\"C\\:\\\\Program\\ Files\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Google\\\\Chrome\\\\Application\\\\chrome.exe\")) OR (process.executable:(\"C\\:\\\\Program\\ Files\\\\Mozilla\\ Firefox\\\\firefox.exe\" OR \"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Mozilla\\ Firefox\\\\firefox.exe\")) OR (process.executable:(\"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Internet\\ Explorer\\\\iexplore.exe\" OR \"C\\:\\\\Program\\ Files\\\\Internet\\ Explorer\\\\iexplore.exe\")) OR process.executable:*\\\\maxthon.exe OR (process.executable:\"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\EdgeWebView\\\\Application\\\\*\" OR process.executable:*\\\\WindowsApps\\\\MicrosoftEdge.exe OR (process.executable:(\"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\" OR \"C\\:\\\\Program\\ Files\\\\Microsoft\\\\Edge\\\\Application\\\\msedge.exe\"))) OR ((process.executable:(\"C\\:\\\\Program\\ Files\\ \\(x86\\)\\\\Microsoft\\\\EdgeCore\\\\*\" OR \"C\\:\\\\Program\\ Files\\\\Microsoft\\\\EdgeCore\\\\*\")) AND (process.executable:(*\\\\msedge.exe OR *\\\\msedgewebview2.exe))) OR process.executable:*\\\\opera.exe OR process.executable:*\\\\safari.exe OR process.executable:*\\\\seamonkey.exe OR process.executable:*\\\\vivaldi.exe OR process.executable:*\\\\whale.exe))",
            "insightidr": "(QueryName ICONTAINS-ANY [\"api.2ip.ua\", \"api.bigdatacloud.net\", \"api.ipify.org\", \"bot.whatismyipaddress.com\", \"canireachthe.net\", \"checkip.amazonaws.com\", \"checkip.dyndns.org\", \"curlmyip.com\", \"db-ip.com\", \"edns.ip-api.com\", \"eth0.me\", \"freegeoip.app\", \"geoipy.com\", \"getip.pro\", \"icanhazip.com\", \"ident.me\", \"ifconfig.io\", \"ifconfig.me\", \"ipapi.co\", \"ip-api.com\", \"ip.anysrc.net\", \"ip.tyk.nu\", \"ipaddressworld.com\", \"ipecho.net\", \"ipinfo.io\", \"ipof.in\", \"ipv4.icanhazip.com\", \"ipv4bot.whatismyipaddress.com\", \"ipwho.is\", \"l2.io\", \"myexternalip.com\", \"wgetip.com\", \"whatismyip.akamai.com\", \"wtfismyip.com\"]) AND NOT (Image=/.*\\\\brave\\.exe$/i OR Image IIN [\"C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe\", \"C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe\"] OR Image IIN [\"C:\\Program Files\\Mozilla Firefox\\firefox.exe\", \"C:\\Program Files (x86)\\Mozilla Firefox\\firefox.exe\"] OR Image IIN [\"C:\\Program Files (x86)\\Internet Explorer\\iexplore.exe\", \"C:\\Program Files\\Internet Explorer\\iexplore.exe\"] OR Image=/.*\\\\maxthon\\.exe$/i OR Image ISTARTS-WITH \"C:\\Program Files (x86)\\Microsoft\\EdgeWebView\\Application\\\" OR Image=/.*\\\\WindowsApps\\\\MicrosoftEdge\\.exe$/i OR Image IIN [\"C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe\", \"C:\\Program Files\\Microsoft\\Edge\\Application\\msedge.exe\"] OR (Image ISTARTS-WITH-ANY [\"C:\\Program Files (x86)\\Microsoft\\EdgeCore\\\", \"C:\\Program Files\\Microsoft\\EdgeCore\\\"]) AND (Image=/(.*\\\\msedge\\.exe$|.*\\\\msedgewebview2\\.exe$)/i) OR Image=/.*\\\\opera\\.exe$/i OR Image=/.*\\\\safari\\.exe$/i OR Image=/.*\\\\seamonkey\\.exe$/i OR Image=/.*\\\\vivaldi\\.exe$/i OR Image=/.*\\\\whale\\.exe$/i)"
        },
        {
            "name": "Remote Thread Creation By Uncommon Source Image",
            "splunk": "SourceImage IN (\"*\\\\explorer.exe\", \"*\\\\iexplore.exe\", \"*\\\\msiexec.exe\", \"*\\\\powerpnt.exe\", \"*\\\\schtasks.exe\", \"*\\\\winlogon.exe\") NOT ((SourceImage=\"*:\\\\Windows\\\\System32\\\\winlogon.exe\" TargetImage IN (\"*:\\\\Windows\\\\System32\\\\services.exe\", \"*:\\\\Windows\\\\System32\\\\wininit.exe\", \"*:\\\\Windows\\\\System32\\\\csrss.exe\", \"*:\\\\Windows\\\\System32\\\\LogonUI.exe\")) OR (SourceImage=\"*:\\\\Windows\\\\System32\\\\winlogon.exe*\" TargetParentProcessId=4) OR (SourceImage IN (\"*:\\\\Windows\\\\System32\\\\schtasks.exe\", \"*:\\\\Windows\\\\SysWOW64\\\\schtasks.exe\") TargetImage=\"*:\\\\Windows\\\\System32\\\\conhost.exe\") OR (SourceImage=\"*:\\\\Windows\\\\explorer.exe\" TargetImage IN (\"*:\\\\Program Files (x86)\\\\\", \"*:\\\\Program Files\\\\\", \"*:\\\\Windows\\\\System32\\\\\", \"*:\\\\Windows\\\\SysWOW64\\\\\")) OR TargetImage=\"System\" OR (SourceImage=\"*\\\\msiexec.exe\" TargetImage IN (\"*\\\\AppData\\\\Local\\\\*\", \"*:\\\\Program Files (x86)\\\\*\", \"*:\\\\Program Files\\\\*\"))) NOT ((SourceImage=\"*:\\\\Program Files\\\\internet explorer\\\\iexplore.exe*\" SourceCommandLine=\"*https://*\" SourceCommandLine=\"*.checkpoint.com/documents/*\" SourceCommandLine=\"*SmartConsole_OLH/*\" SourceCommandLine=\"*default.htm#cshid=*\") OR (SourceImage=\"*:\\\\Program Files\\\\internet explorer\\\\iexplore.exe*\" SourceParentImage=\"*:\\\\Program Files*\" SourceParentImage=\"*\\\\CheckPoint\\\\SmartConsole\\\\*\" SourceParentImage=\"*\\\\SmartConsole.exe*\") OR (SourceImage=\"*\\\\Microsoft Office\\\\*\" SourceImage=\"*\\\\POWERPNT.EXE\" TargetImage=\"*:\\\\Windows\\\\System32\\\\csrss.exe\"))",
            "elastic": "(process.executable:(*\\\\explorer.exe OR *\\\\iexplore.exe OR *\\\\msiexec.exe OR *\\\\powerpnt.exe OR *\\\\schtasks.exe OR *\\\\winlogon.exe)) AND (NOT ((process.executable:*\\:\\\\Windows\\\\System32\\\\winlogon.exe AND (winlog.event_data.TargetImage:(*\\:\\\\Windows\\\\System32\\\\services.exe OR *\\:\\\\Windows\\\\System32\\\\wininit.exe OR *\\:\\\\Windows\\\\System32\\\\csrss.exe OR *\\:\\\\Windows\\\\System32\\\\LogonUI.exe))) OR (process.executable:*\\:\\\\Windows\\\\System32\\\\winlogon.exe* AND winlog.event_data.TargetParentProcessId:4) OR ((process.executable:(*\\:\\\\Windows\\\\System32\\\\schtasks.exe OR *\\:\\\\Windows\\\\SysWOW64\\\\schtasks.exe)) AND winlog.event_data.TargetImage:*\\:\\\\Windows\\\\System32\\\\conhost.exe) OR (process.executable:*\\:\\\\Windows\\\\explorer.exe AND (winlog.event_data.TargetImage:(\"*\\:\\\\Program\\ Files\\ \\(x86\\)\\\\\" OR \"*\\:\\\\Program\\ Files\\\\\" OR *\\:\\\\Windows\\\\System32\\\\ OR *\\:\\\\Windows\\\\SysWOW64\\\\))) OR winlog.event_data.TargetImage:System OR (process.executable:*\\\\msiexec.exe AND (winlog.event_data.TargetImage:(*\\\\AppData\\\\Local\\\\* OR \"*\\:\\\\Program\\ Files\\ \\(x86\\)\\\\*\" OR \"*\\:\\\\Program\\ Files\\\\*\"))))) AND (NOT ((process.executable:\"*\\:\\\\Program\\ Files\\\\internet\\ explorer\\\\iexplore.exe*\" AND (winlog.event_data.SourceCommandLine:*https\\:\\/\\/* AND winlog.event_data.SourceCommandLine:*.checkpoint.com\\/documents\\/* AND winlog.event_data.SourceCommandLine:*SmartConsole_OLH\\/* AND winlog.event_data.SourceCommandLine:*default.htm#cshid\\=*)) OR (process.executable:\"*\\:\\\\Program\\ Files\\\\internet\\ explorer\\\\iexplore.exe*\" AND (winlog.event_data.SourceParentImage:\"*\\:\\\\Program\\ Files*\" AND winlog.event_data.SourceParentImage:*\\\\CheckPoint\\\\SmartConsole\\\\* AND winlog.event_data.SourceParentImage:*\\\\SmartConsole.exe*)) OR (process.executable:\"*\\\\Microsoft\\ Office\\\\*\" AND process.executable:*\\\\POWERPNT.EXE AND winlog.event_data.TargetImage:*\\:\\\\Windows\\\\System32\\\\csrss.exe)))",
            "insightidr": "(SourceImage=/(.*\\\\explorer\\.exe$|.*\\\\iexplore\\.exe$|.*\\\\msiexec\\.exe$|.*\\\\powerpnt\\.exe$|.*\\\\schtasks\\.exe$|.*\\\\winlogon\\.exe$)/i) AND NOT (SourceImage=/.*:\\\\Windows\\\\System32\\\\winlogon\\.exe$/i AND (TargetImage=/(.*:\\\\Windows\\\\System32\\\\services\\.exe$|.*:\\\\Windows\\\\System32\\\\wininit\\.exe$|.*:\\\\Windows\\\\System32\\\\csrss\\.exe$|.*:\\\\Windows\\\\System32\\\\LogonUI\\.exe$)/i) OR SourceImage ICONTAINS \":\\Windows\\System32\\winlogon.exe\" AND TargetParentProcessId=4 OR (SourceImage=/(.*:\\\\Windows\\\\System32\\\\schtasks\\.exe$|.*:\\\\Windows\\\\SysWOW64\\\\schtasks\\.exe$)/i) AND TargetImage=/.*:\\\\Windows\\\\System32\\\\conhost\\.exe$/i OR SourceImage=/.*:\\\\Windows\\\\explorer\\.exe$/i AND (TargetImage=/(.*:\\\\Program\\ Files\\ \\(x86\\)\\\\$|.*:\\\\Program\\ Files\\\\$|.*:\\\\Windows\\\\System32\\\\$|.*:\\\\Windows\\\\SysWOW64\\\\$)/i) OR TargetImage = NOCASE(\"System\") OR SourceImage=/.*\\\\msiexec\\.exe$/i AND (TargetImage ICONTAINS-ANY [\"\\AppData\\Local\\\", \":\\Program Files (x86)\\\", \":\\Program Files\\\"])) AND NOT (SourceImage ICONTAINS \":\\Program Files\\internet explorer\\iexplore.exe\" AND SourceCommandLine ICONTAINS-ALL [\"https://\", \".checkpoint.com/documents/\", \"SmartConsole_OLH/\", \"default.htm#cshid=\"] OR SourceImage ICONTAINS \":\\Program Files\\internet explorer\\iexplore.exe\" AND SourceParentImage ICONTAINS-ALL [\":\\Program Files\", \"\\CheckPoint\\SmartConsole\\\", \"\\SmartConsole.exe\"] OR SourceImage ICONTAINS \"\\Microsoft Office\\\" AND SourceImage=/.*\\\\POWERPNT\\.EXE$/i AND TargetImage=/.*:\\\\Windows\\\\System32\\\\csrss\\.exe$/i)"
        },
        {
            "name": "Rare Remote Thread Creation By Uncommon Source Image",
            "splunk": "SourceImage IN (\"*\\\\bash.exe\", \"*\\\\cscript.exe\", \"*\\\\cvtres.exe\", \"*\\\\defrag.exe\", \"*\\\\dnx.exe\", \"*\\\\esentutl.exe\", \"*\\\\excel.exe\", \"*\\\\expand.exe\", \"*\\\\find.exe\", \"*\\\\findstr.exe\", \"*\\\\forfiles.exe\", \"*\\\\gpupdate.exe\", \"*\\\\hh.exe\", \"*\\\\installutil.exe\", \"*\\\\lync.exe\", \"*\\\\makecab.exe\", \"*\\\\mDNSResponder.exe\", \"*\\\\monitoringhost.exe\", \"*\\\\msbuild.exe\", \"*\\\\mshta.exe\", \"*\\\\mspaint.exe\", \"*\\\\outlook.exe\", \"*\\\\ping.exe\", \"*\\\\provtool.exe\", \"*\\\\python.exe\", \"*\\\\regsvr32.exe\", \"*\\\\robocopy.exe\", \"*\\\\runonce.exe\", \"*\\\\sapcimc.exe\", \"*\\\\smartscreen.exe\", \"*\\\\spoolsv.exe\", \"*\\\\tstheme.exe\", \"*\\\\userinit.exe\", \"*\\\\vssadmin.exe\", \"*\\\\vssvc.exe\", \"*\\\\w3wp.exe\", \"*\\\\winscp.exe\", \"*\\\\winword.exe\", \"*\\\\wmic.exe\", \"*\\\\wscript.exe\")",
            "elastic": "process.executable:(*\\\\bash.exe OR *\\\\cscript.exe OR *\\\\cvtres.exe OR *\\\\defrag.exe OR *\\\\dnx.exe OR *\\\\esentutl.exe OR *\\\\excel.exe OR *\\\\expand.exe OR *\\\\find.exe OR *\\\\findstr.exe OR *\\\\forfiles.exe OR *\\\\gpupdate.exe OR *\\\\hh.exe OR *\\\\installutil.exe OR *\\\\lync.exe OR *\\\\makecab.exe OR *\\\\mDNSResponder.exe OR *\\\\monitoringhost.exe OR *\\\\msbuild.exe OR *\\\\mshta.exe OR *\\\\mspaint.exe OR *\\\\outlook.exe OR *\\\\ping.exe OR *\\\\provtool.exe OR *\\\\python.exe OR *\\\\regsvr32.exe OR *\\\\robocopy.exe OR *\\\\runonce.exe OR *\\\\sapcimc.exe OR *\\\\smartscreen.exe OR *\\\\spoolsv.exe OR *\\\\tstheme.exe OR *\\\\userinit.exe OR *\\\\vssadmin.exe OR *\\\\vssvc.exe OR *\\\\w3wp.exe OR *\\\\winscp.exe OR *\\\\winword.exe OR *\\\\wmic.exe OR *\\\\wscript.exe)",
            "insightidr": "SourceImage=/(.*\\\\bash\\.exe$|.*\\\\cscript\\.exe$|.*\\\\cvtres\\.exe$|.*\\\\defrag\\.exe$|.*\\\\dnx\\.exe$|.*\\\\esentutl\\.exe$|.*\\\\excel\\.exe$|.*\\\\expand\\.exe$|.*\\\\find\\.exe$|.*\\\\findstr\\.exe$|.*\\\\forfiles\\.exe$|.*\\\\gpupdate\\.exe$|.*\\\\hh\\.exe$|.*\\\\installutil\\.exe$|.*\\\\lync\\.exe$|.*\\\\makecab\\.exe$|.*\\\\mDNSResponder\\.exe$|.*\\\\monitoringhost\\.exe$|.*\\\\msbuild\\.exe$|.*\\\\mshta\\.exe$|.*\\\\mspaint\\.exe$|.*\\\\outlook\\.exe$|.*\\\\ping\\.exe$|.*\\\\provtool\\.exe$|.*\\\\python\\.exe$|.*\\\\regsvr32\\.exe$|.*\\\\robocopy\\.exe$|.*\\\\runonce\\.exe$|.*\\\\sapcimc\\.exe$|.*\\\\smartscreen\\.exe$|.*\\\\spoolsv\\.exe$|.*\\\\tstheme\\.exe$|.*\\\\userinit\\.exe$|.*\\\\vssadmin\\.exe$|.*\\\\vssvc\\.exe$|.*\\\\w3wp\\.exe$|.*\\\\winscp\\.exe$|.*\\\\winword\\.exe$|.*\\\\wmic\\.exe$|.*\\\\wscript\\.exe$)/i"
        }
    ]
}
